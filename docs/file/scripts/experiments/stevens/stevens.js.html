<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">scripts/experiments/stevens/stevens.js | vcl-web-framework</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<script src="./inject/script/0-conditions-config.js"></script><script src="./inject/script/0-experiments-config.js"></script><script src="./inject/script/0-graphing-config.js"></script><script src="./inject/script/0-trial-structure-config.js"></script><script src="./inject/script/0-balancing-config.js"></script><script src="./inject/script/0-view-controller.js"></script><script src="./inject/script/0-experiments-renderer.js"></script><script src="./inject/script/0-conditions-renderer.js"></script><script src="./inject/script/0-supported-properties-renderer.js"></script><link rel="stylesheet" href="./inject/css/0-styles.css"><meta name="description" content="This is a Node.js application that runs correlation-related experiments of the VCL Lab."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="vcl-web-framework"><meta property="twitter:description" content="This is a Node.js application that runs correlation-related experiments of the VCL Lab."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/UBC-VCL/VCLWebFramework.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing">experiment-properties/balancing</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-balance_subconditions">balance_subconditions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing-balancing-helpers">experiment-properties/balancing/balancing_helpers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_index_array">generate_index_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_any_array">get_any_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_any_array_repeated">get_any_array_repeated</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_permutation">get_permutation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_remaining_elements">get_remaining_elements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-heapsPermute">heapsPermute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-reorder">reorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-shuffle">shuffle</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing-generators">experiment-properties/balancing/generators</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_blocked_latin_square">initialize_blocked_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-innitialize_custom_latin_square">innitialize_custom_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_counter_balanced_order">generate_counter_balanced_order</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-innitialize_custom_order">innitialize_custom_order</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_latin_square">initialize_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_random_order">initialize_random_order</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-counter">experiment-properties/counter</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-print_curr_trial">print_curr_trial</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-data">experiment-properties/data</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_custom_subcondition">get_custom_subcondition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_condition_dataset">create_condition_dataset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_design_condition_dataset">create_design_condition_dataset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_data">get_data</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_data_subset">get_data_subset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CUSTOM_TRIAL_STRUCTURE_CONDITIONS">CUSTOM_TRIAL_STRUCTURE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EXPERIMENT_BASES">EXPERIMENT_BASES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EXPERIMENT_CONDITIONS">EXPERIMENT_CONDITIONS</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-data-constants">experiment-properties/data/constants</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENSEMBLE_AVERAGE_BASE">ENSEMBLE_AVERAGE_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENSEMBLE_AVERAGE_CONDITIONS">ENSEMBLE_AVERAGE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ESTIMATION_CONDITIONS">ESTIMATION_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYBRID_BASE">HYBRID_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYBRID_CONDITIONS">HYBRID_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_BASE">JND_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_CONDITIONS">JND_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_RADIUS_BASE">JND_RADIUS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_RADIUS_CONDITIONS">JND_RADIUS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NUMEROSITY_BASE">NUMEROSITY_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NUMEROSITY_CONDITIONS">NUMEROSITY_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_BASE">SEQUENCING_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_CONDITIONS">SEQUENCING_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SIDE_BY_SIDE_BASE">SEQUENCING_SIDE_BY_SIDE_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SIDE_BY_SIDE_CONDITIONS">SEQUENCING_SIDE_BY_SIDE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SYMBOLS_BASE">SEQUENCING_SYMBOLS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SYMBOLS_CONDITIONS">SEQUENCING_SYMBOLS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STEVENS_BASE">STEVENS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STEVENS_CONDITIONS">STEVENS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VISUAL_SEARCH_BASE">VISUAL_SEARCH_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VISUAL_SEARCH_CONDITIONS">VISUAL_SEARCH_CONDITIONS</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-distribution">experiment-properties/distribution</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_adjusted_distribution">generate_adjusted_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_initial_distribution">generate_initial_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_random_distribution">generate_random_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-correlationNotWithinError">correlationNotWithinError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateDistribution">generateDistribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomGaussian">generateRandomGaussian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getPearsonCorrelation">getPearsonCorrelation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pointNotWithinRequiredStdDevs">pointNotWithinRequiredStdDevs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_coordinates">prepare_coordinates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-random_bm">random_bm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readjustPoints">readjustPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transformPoints">transformPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomDistribution">generateRandomDistribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomUniform">generateRandomUniform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateUniformDistribution">generateUniformDistribution</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing">experiment-properties/graphing</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_color">generate_color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_color_hex">generate_color_hex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_custom_plot">is_custom_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_custom_plot">prepare_custom_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add_graph_features">add_graph_features</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_attributes_object">generate_attributes_object</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_distributions">plot_distributions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-base-plots">experiment-properties/graphing/d3-base-plots</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_parallel_plot">create_parallel_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_ring_plot">create_ring_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_scatter_plot">create_scatter_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_scatter_points">plot_scatter_points</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_shape_plot">create_shape_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_strip_plot">create_strip_plot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-custom-plots">experiment-properties/graphing/d3-custom-plots</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_distractor_scatter_plot">create_distractor_scatter_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_bisection_plot">create_estimation_bisection_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_interference_plot">create_estimation_interference_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_multi_interference_plot">create_estimation_multi_interference_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_plot">create_estimation_plot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-plot-features">experiment-properties/graphing/d3-plot-features</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-combine_target_and_distractor">combine_target_and_distractor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_mixed_attribute_graph">plot_mixed_attribute_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_array_mix_graph">prepare_array_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_mix_graph">prepare_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_targeted_mix_graph">prepare_targeted_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_visual_mask_graph">prepare_visual_mask_graph</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-instructions">experiment-properties/instructions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_subcond_instruction_block">generate_subcond_instruction_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_instructions">get_instructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_jspsych_instructions">get_jspsych_instructions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-instruction-screen">experiment-timeline/instruction_screen</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_instructions">generate_instructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_ready_screen">generate_ready_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_sitting_distance_screen">generate_sitting_distance_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_welcome">generate_welcome</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-resolution-scaling">experiment-timeline/resolution_scaling</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-manual_resolution_scaling">manual_resolution_scaling</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resolution_scaling">resolution_scaling</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-screening">experiment-timeline/screening</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningInstructions">screeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningPCPInverted">screeningPCPInverted</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-instructionsRegression">instructionsRegression</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningCorrelationSelect">screeningCorrelationSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningCorrelationSort">screeningCorrelationSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningInstructions">screeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningQuestions">screeningQuestions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningRegressionSelect">screeningRegressionSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-colorScreeningInstructions">colorScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ignoreScreeningInstructions">ignoreScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-luminanceScreeningInstructions">luminanceScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-orientationScreeningInstructions">orientationScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningStripColorYellowBlue">screeningStripColorYellowBlue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screenningStripLuminanceSort">screenningStripLuminanceSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screenningStripOrientationSort">screenningStripOrientationSort</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-ensemble-average">experiments/ensemble_average</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/ensemble_average/ensemble_average.js~Ensemble_Average.html">Ensemble_Average</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ensemble_avg_exp">ensemble_avg_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-estimation">experiments/estimation</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/estimation/estimation.js~Estimation.html">Estimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-estimation_exp">estimation_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-hybrid">experiments/hybrid</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/hybrid/hybrid.js~Hybrid.html">Hybrid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hybrid_exp">hybrid_exp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_exp">jnd_exp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stevens_exp">stevens_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-jnd">experiments/jnd</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/jnd/jnd.js~JND.html">JND</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_block">generate_experiment_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_end">generate_experiment_end</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_screen">generate_feedback_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_block">generate_practice_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_ready_experiment">generate_ready_experiment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_stop_block">generate_stop_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_exp">jnd_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-jnd-radius">experiments/jnd_radius</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/jnd_radius/jnd_radius.js~JND_Radius.html">JND_Radius</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_radius_exp">jnd_radius_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-numerosity">experiments/numerosity</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/numerosity/numerosity.js~Numerosity.html">Numerosity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-numerosity_exp">numerosity_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing">experiments/sequencing</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing/sequencing.js~Sequencing.html">Sequencing</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IMAGE_PATH">IMAGE_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_exp">sequencing_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing-side-by-side">experiments/sequencing_side_by_side</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing_side_by_side/sequencing_side_by_side.js~Sequencing_Side_by_Side.html">Sequencing_Side_by_Side</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IMAGE_PATH">IMAGE_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_side_by_side_exp">sequencing_side_by_side_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing-symbols">experiments/sequencing_symbols</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing_symbols/sequencing_symbols.js~Sequencing_Symbols.html">Sequencing_Symbols</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment">generate_experiment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_end">generate_experiment_end</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_screen">generate_feedback_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_wrapper">generate_feedback_wrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_block">generate_practice_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_instruction_block">generate_practice_instruction_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_stop_practice_trials">generate_stop_practice_trials</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECTANGLE_MASK_PATH">RECTANGLE_MASK_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SQUARE_MASK_PATH">SQUARE_MASK_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_symbols_exp">sequencing_symbols_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-stevens">experiments/stevens</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/stevens/stevens.js~Stevens.html">Stevens</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stevens_exp">stevens_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-visual-search">experiments/visual_search</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/visual_search/visual_search_timeline.js~Visual_Search.html">Visual_Search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_color_paths">get_color_paths</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hex_to_color">hex_to_color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-visual_search_exp">visual_search_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#helpers">helpers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/helpers/correlation_dependencies.js~Correlation_Dependencies.html">Correlation_Dependencies</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-above_and_below_generate_random_trial_array">above_and_below_generate_random_trial_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-bundle_z_values">bundle_z_values</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-check_params">check_params</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-force_greater_right_position">force_greater_right_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feature_search_trials">generate_feature_search_trials</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_timeline_screen">generate_timeline_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-genereate_hybrid_instruction">genereate_hybrid_instruction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getScreenHeight">getScreenHeight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_mixed_graph_styles">get_mixed_graph_styles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_mixed_masks">get_mixed_masks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_num_blocks">get_num_blocks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_running_average">get_running_average</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_single_graph_style">get_single_graph_style</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_single_mask">get_single_mask</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_converged_in_window">is_converged_in_window</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nova_variables">nova_variables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_graph_attributes_mixed">randomize_graph_attributes_mixed</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_position">randomize_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_position_symmetric">randomize_position_symmetric</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_radius_position">randomize_radius_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-repeat_y_values">repeat_y_values</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-shuffleArray">shuffleArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-correlation_dependencies">correlation_dependencies</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">scripts/experiments/stevens/stevens.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { balance_subconditions } from &apos;/scripts/experiment-properties/balancing/balancing_controller.js&apos;
import { plot_distributions } from &quot;/scripts/experiment-properties/graphing/graphing_controller.js&quot;;
import { print_curr_trial } from &quot;/scripts/experiment-properties/counter/counter_controller.js&quot;;
import { initialize_latin_square } from &apos;/scripts/experiment-properties/balancing/generators/latin_square_generator.js&apos;
import { initialize_random_order } from &apos;/scripts/experiment-properties/balancing/generators/random_generator.js&apos;
import { get_data } from &apos;/scripts/experiment-properties/data/data_controller.js&apos;
import { generateDistribution } from &apos;/scripts/experiment-properties/distribution/gaussian_distribution_generator.js&apos;
import { generate_adjusted_distribution, generate_initial_distribution, generate_random_distribution} from &apos;/scripts/experiment-properties/distribution/distribution_controller.js&apos;
import { randomize_position, shuffleArray } from &apos;/scripts/helpers/experiment_helpers.js&apos;
import { EXPERIMENTS } from &quot;/config/experiments-config.js&quot;;

const ADDRESS_BASE = `${location.protocol}//${location.hostname}:${location.port}`;


export default class Stevens {

  /**
   * Initializes a Stevens experiment object. 
   *
   * @param  params {assoc array}  Parameters passed from routing.
   */
  constructor(params) {

    console.log(&quot;stevens.js log&quot;, params)

    let trial_structure = params[&quot;trial_structure&quot;];
    let condition_name = params[&quot;condition&quot;];
    let graph_type = params[&quot;graph_type&quot;];
    let balancing_type = params[&quot;balancing&quot;];
    let conversion_factor = params[&quot;conversion_factor&quot;];

    this.condition_name = condition_name; 
    this.condition_group = this.condition_name.split(&apos;_&apos;)[0]; // Mostly to handle &quot;distractor&quot; conditions.
                                                              // TODO: Should have a better flag for it.
    this.subject_id = params[&quot;subject_id&quot;];
    this.subject_initials = params[&quot;subject_initials&quot;];

    this.estimated_mid_values = [];
    this.is_practice = params[&quot;is_practice_trials&quot;];
    this.is_screening = params[&quot;is_screening&quot;];
    this.custom_subcondition_order = params[&quot;custom_subcondition_order&quot;];

    this.is_hybrid = false; // whether this is a part of hybrid experiment
    this.hybrid_2nd_practice = false;

    // ========================================
    // PARAMETER CHECKING

    // **NOTE: EXPERIMENTS variable comes from /public/config/experiments-config.js
    if (!EXPERIMENTS[&quot;stevens&quot;][&quot;trial_structure&quot;].includes(trial_structure)) {
      throw Error(trial_structure + &quot; is not supported.&quot;);}
    else {
      this.trial_structure = trial_structure;
    }

    if (!EXPERIMENTS[&quot;stevens&quot;][&quot;graph_type&quot;].includes(graph_type)){
      throw Error(graph_type + &quot; is not supported.&quot;)} 
    else { 
      this.graph_type = graph_type;
    };  

    if (!EXPERIMENTS[&quot;stevens&quot;][&quot;balancing_type&quot;].includes(balancing_type)) {
      throw Error(balancing_type + &quot; is not supported.&quot;) }
    else {
      this.balancing_type = balancing_type;
    }  

    // ========================================
    // EXPERIMENT CONSTANTS

    this.PIXELS_PER_CM = conversion_factor; // DEPRECATED do not use
    this.MAX_STEP_INTERVAL = 10;

    // ========================================
    // EXPERIMENT VARIABLES
    this.EXPERIMENT_NAME = &quot;Stevens&quot;;
    this.input_count_array; // Array of length trials_per_round, each index representing num inputs per round 
                            // for a given sub condition
    this.sub_conditions_constants;
    this.current_sub_condition_index;
    this.round_end = false;
    this.num_trial_complete = 0;

    // ========================================
    // PRACTICE EXPERIMENT VARIABLES

    this.practice_conditions_constants;
    this.curr_practice_condition_index
    this.adjusted_midpoint_matrix = {}; 
    this.practice_trial_data = [];
    this.practice_end = !this.is_practice;;

    // ========================================
    // TEST EXPERIMENT VARIABLES

    this.experiment_conditions_constants;
    this.sub_condition_order = [];

    // ========================================
    // CURRENT TRIAL DATA

    // Plotting-related vars
    this.left_coordinates = &quot;&quot;;
    this.right_coordinates = &quot;&quot;;
    this.middle_coordinates = &quot;&quot;;
    this.distractor_coordinates = &quot;&quot;;

    // JsPsych trial_data for the current trial
    this.trial_data = &quot;&quot;;

    // ========================================
    // PREPARE EXPERIMENT

    // Extract raw constants
    this.raw_constants = get_data(this);
    
    // Prepare experiment + practice data
    this.prepare_experiment();
    this.prepare_practice();  

  }

  /**
   * Orders the input data according to balancing type and
   * initializes the Stevens object&apos;s variables.  
   *
   * @param  balancing_type {string}                           Type of balancing. Currently only latin_square
   *                                                           is supported.
   *         dataset {[{assoc array}, {assoc array}, ... ]}   The data to be ordered. 
   */
  prepare_experiment() {

    let dataset = this.raw_constants;
    var ordered_dataset = [];
    console.log(this.raw_constants)
    console.log(this.trial_structure)
    switch (this.trial_structure) {

      case &quot;foundational&quot;:
        this.set_foundational_dataset_order(dataset);
        break;

      case &quot;design&quot;:
        this.sub_condition_order = balance_subconditions(this.balancing_type, this.constructor.name.toLowerCase(), dataset.length, dataset, &quot;block&quot;, this.custom_subcondition_order);
        break;

      case &quot;custom&quot;:
        ordered_dataset = dataset;
        break;
    }
    // Order the data set according to the latin square
    for (let i = 0; i &lt; this.sub_condition_order.length; i++){
      ordered_dataset[i] = dataset[this.sub_condition_order[i]];
      // Alternate the start ref to be low or high for each subcondition
      if (i % 2 === 0) {
        ordered_dataset[i][&quot;start_ref&quot;] = ordered_dataset[i][&quot;starting_low_ref&quot;] ? ordered_dataset[i][&quot;starting_low_ref&quot;] : ordered_dataset[i][&quot;low_ref&quot;];
      } else {
        ordered_dataset[i][&quot;start_ref&quot;] = ordered_dataset[i][&quot;starting_high_ref&quot;] ? ordered_dataset[i][&quot;starting_high_ref&quot;] : ordered_dataset[i][&quot;high_ref&quot;];
      }
    
    }

    // Set experiment trials
    this.sub_conditions_constants = ordered_dataset;
    this.current_sub_condition_index = 0;
    this.input_count_array = new Array(this.sub_conditions_constants[0].trials_per_round).fill(0);
    
    for (let i=0; i &lt; this.sub_conditions_constants.length; i++){
      this.estimated_mid_values[i] = [];
    } 
  }

  /**
   * Creates the practice dataset by taking the first FOUR subconditions.
   *
   * @param  dataset {[{assoc array}, {assoc array}, ... ]}   The data to be ordered. 
   */
  prepare_practice() {
    let practice_dataset = [];
    let practice_index = 0;
    if (this.sub_conditions_constants[practice_index].num_points &lt;= 12) {
      practice_index = 2
    } else {
      practice_index = 0
    }
    practice_dataset.push(this.sub_conditions_constants[practice_index]);
    practice_dataset.push(this.sub_conditions_constants[practice_index]);
    // Alternate the start ref to be low or high for each subcondition
    for(let i = 0; i &lt; practice_dataset.length; i++){
      this.practice_trial_data.push([])
      if (i % 2 === 0) {
        practice_dataset[i][&quot;start_ref&quot;] = this.sub_conditions_constants[practice_index][&quot;starting_low_ref&quot;] ? this.sub_conditions_constants[i][&quot;starting_low_ref&quot;] : this.sub_conditions_constants[i][&quot;low_ref&quot;];
      } else {
        practice_dataset[i][&quot;start_ref&quot;] = this.sub_conditions_constants[practice_index][&quot;starting_high_ref&quot;] ? this.sub_conditions_constants[i][&quot;starting_high_ref&quot;] : this.sub_conditions_constants[i][&quot;high_ref&quot;];
      }
    }
    
    this.practice_conditions_constants = practice_dataset;
    this.curr_practice_condition_index = 0;
    this.practice_input_count_array = new Array(this.practice_conditions_constants[0].trials_per_round).fill(0);
  }

  prepare_sample_trials(){
    let stevens_sample_graps = []
    let mid_correlations = [0.5,0.6,0.7,0.8,0.9]
    for(let i = 0; i &lt; 5; i++){
      let mid_correlation = mid_correlations[i];
      let sample_trial = this.generate_sample_trial(mid_correlation);
      stevens_sample_graps.push(sample_trial)
    }
    shuffleArray(stevens_sample_graps)
    return stevens_sample_graps;
  }

  generate_sample_trial(mid_correlation){
    let stevens_exp = this;
    let address = stevens_exp.is_hybrid ? ADDRESS_BASE + &quot;/hybrid_trial&quot; : ADDRESS_BASE + &quot;/stevens_trial&quot;;
    this.display_mode = &quot;sample&quot;;
    let sample_trial = {
      type:&apos;d3-plot-keyboard-response&apos;,
      block_type: &quot;sample&quot;,
      url: address,
      trial_duration: 5000,  
      choices: jsPsych.NO_KEYS,
      execute_script: true,
      response_ends_trial: true,
      plot_distributions: plot_distributions,
      print_curr_trial: print_curr_trial,
      order: &quot;stevens&quot;,
      exp_obj: stevens_exp, 
      data: {},
      on_start: function(trial){ 
        stevens_exp.display_mode = &quot;sample&quot;;
        stevens_exp.sample_mid_correlation = mid_correlation;
        let block_type = &quot;test&quot;;
        let index = stevens_exp.getIndex(block_type); 
        let constants = stevens_exp.getConstants(block_type,index);

        trial.data = Object.assign({}, trial.data, constants);
        trial.data.constants = constants;
        trial.data.sub_condition = index;
        
        var high_coordinates = generate_adjusted_distribution(constants, constants.high_ref)
        
        var low_coordinates = generate_adjusted_distribution(constants, constants.low_ref)
        
        var estimated_coordinates = generate_adjusted_distribution(constants, mid_correlation)
        
      
        var result = randomize_position(trial, 
                                        high_coordinates,
                                        low_coordinates, 
                                        constants.high_ref, 
                                        constants.low_ref);
        trial.data.high_ref_is_right = result.base_is_right;

        if (trial.data.high_ref_is_right){
          stevens_exp.right_coordinates = high_coordinates;
          stevens_exp.left_coordinates = low_coordinates;
          stevens_exp.coordinates = [low_coordinates, estimated_coordinates, high_coordinates];
        }
        else{
          stevens_exp.right_coordinates = low_coordinates;
          stevens_exp.left_coordinates = high_coordinates;
          stevens_exp.coordinates = [high_coordinates, estimated_coordinates, low_coordinates];
        }
        
        console.log(&quot;[RIGHT] Correlation: &quot; + trial.data.right_correlation);
        console.log(&quot;[MIDPOINT] Correlation: &quot; + trial.data.estimated_mid);
        console.log(&quot;[LEFT] Correlation: &quot; + trial.data.left_correlation);
        stevens_exp.trial_data = trial.data; 
        trial.exp_obj = stevens_exp;

      },
    };
    return sample_trial;
  }

  /**
   * Sets the subcondition order for foundational range.
   * Needs to balance INDIVIDUALLY the round and test type conditions,
   * then maintain that order (e.g. all test goes first, then consistency)
   *
   * @param  dataset {[{assoc array}, {assoc array}, ... ]}   The data used to be ordered. 
   */
  set_foundational_dataset_order(dataset) {

    // To hold individual data sets according to round type
    var test_dataset = [];
    var consistency_dataset = [];

    // To hold balanced indexes
    var test_order = []; 
    var consistency_order = [];

    // Extract dataset according to test or consistency round type
    for (let subcondition of dataset) {

      if (subcondition[&quot;round_type&quot;] === &quot;test&quot;) {
        test_dataset.push(subcondition);
      } else {
        consistency_dataset.push(subcondition);
      }
    }

    // Get balancing order for EACH round type dataset individually
    switch(this.balancing_type) {

      case &apos;latin_square&apos;:
        test_order = initialize_latin_square(test_dataset.length);
        consistency_order = initialize_latin_square(consistency_dataset.length);
        break;

      case &apos;random&apos;:
        test_order = initialize_random_order(test_dataset.length);
        consistency_order = initialize_random_order(consistency_dataset.length);
        break;

      default:
        throw Error(this.balancing_type + &quot; balancing type is not supported.&quot;);
    }

    // Since test dataset will run first, add index length of it to consistency order
    for (let i = 0; i &lt; consistency_order.length; i++) {
      consistency_order[i] += test_dataset.length;
    }

    //  Merge the two orders 
    this.sub_condition_order = test_order.concat(consistency_order);
  }

  /**
   * Resets all relevant variables to now use the test version.
   * (input_count_array, sub_conditions_constants, and current_sub_condition_index
   * are shared variables between the practice and test trials).
   *
   * This function is called once all the practice trials have run. 
   */
  end_practice_experiment() {
    //this.sub_conditions_constants = this.experiment_conditions_constants;
    this.input_count_array = new Array(this.sub_conditions_constants[0].trials_per_round).fill(0);
    this.current_sub_condition_index = 0;
  }

  /**
   * Calculates exclusion criteria using standard deviation and variance.
   * Subcondition is flagged if:
   * - Standard deviation &gt; 0.2
   * - Anchoring &gt; 0.6
   *
   * @ return     HTML of subcondition data to print onto screen
   */
  calculate_exclusion_criteria() {
    console.log(this.practice_trial_data)
    let string = &quot;&quot;;

    for (let i = 0; i &lt; Object.keys(this.practice_trial_data).length; i++){

      let subcondition_data = this.practice_trial_data[i];
      let range = this.calculate_exclusion_criteria_for_subcondition(subcondition_data);

      string += `
                &lt;div align = &quot;center&quot; style = &quot;text-align: left; float:left;&quot;&gt; &lt;font size = 6&gt;
                Range: ${range}
                &lt;br&gt;
                &lt;/font&gt;
                &lt;/div&gt;
                `
    }

    return string;
  }

  calculate_exclusion_criteria_for_subcondition(subcondition_data){
    let mids = this.get_estimated_mids(subcondition_data);
    let std_dev = this.get_standard_deviation(mids);
    let anchoring_value = this.get_anchoring_value(mids);

    let rounded_mids = [];
    for (let mid of mids) {
      rounded_mids.push(mid.toFixed(3));
    }

    let anchoring_color = &quot;BLACK&quot;;
    if (anchoring_value &gt; 0.5) {
      anchoring_color = &quot;RED&quot;;
    }

    let std_dev_color = &quot;BLACK&quot;;
    if (std_dev &gt; 0.2) {
      std_dev_color = &quot;RED&quot;;
    }
    
    //console.log(rounded_mids);

    var mid_values = [];
    length = rounded_mids.length;
    
    for (var x = 0; x &lt; length; x++) {
      mid_values.push(Number(rounded_mids[x]));

    }

    //console.log(mid_values);
    let range = Math.max.apply(null, mid_values) - Math.min.apply(null, mid_values);
    console.log(range)
    
    console.log(Math.max.apply(null, mid_values));
    console.log(Math.min.apply(null, mid_values));
    return range;
  }

  /**
   * Calculates the standard deviation for the specified subcondition.
   * @ param  {array}   array of estimated mids for that trial
   *
   * @ return {double}  standard deviation
   */
  get_standard_deviation(estimated_mids) {

    let values = [];

    // Calculate mean:
    let mean = 0;
    for (let mid of estimated_mids) {
      mean += mid;
    }
    mean = mean / estimated_mids.length;

    // Calculate variance:
    let variance = 0;
    for (let mid of estimated_mids) {
      variance += Math.pow(mid - mean, 2);
    }
    variance = variance / (estimated_mids.length - 1);

    return Math.sqrt(variance).toFixed(3);
  }

  /**
   * Calculates the anchoring value for the specified subcondition.
   * @ param  {array}   array of estimated mids for that trial
   *
   * @ return {double} anchoring value
   */
  get_anchoring_value(estimated_mids) {

    let high_ref_trial_sum = 0;
    let low_ref_trial_sum = 0;

    // Iterate through each estimated mid (trial) of a given subcondition
    for (let i = 0; i &lt; estimated_mids.length; i++) {
      // Evens have the low ref as their starter 
      if (i % 2 === 0) {
        low_ref_trial_sum += estimated_mids[i];
      } else {
        high_ref_trial_sum += estimated_mids[i];
      }
    }

    return Math.abs(high_ref_trial_sum - low_ref_trial_sum).toFixed(3);
  }

  /**
   * Retrieves the estimated midpoints of each trial for the subcondition.
   *
   * @ return {array}  of estimated mids 
   */
  get_estimated_mids(subcondition_data) {

    let estimated_mids = [];

    for (let trial of subcondition_data) {
      estimated_mids.push(trial.estimated_mid);
    }

    return estimated_mids;
  }

  /**
   * Generates a Stevens object for use in the JsPsych timeline.
   *
   * @param  type {string}                             &quot;test&quot; or &quot;practice&quot;
   * @return trial {object}
   */   
  generate_trial(block_type) {

    if ((block_type !== &quot;test&quot;) &amp;&amp; (block_type !== &quot;practice&quot;)) {throw Error(block_type + &quot; is not supported.&quot;)};
    // Initialize a variable for this so it is usable inside on_start
    var stevens_exp = this; 
    // conditional address for hybrid conditions called from Hybrid Experiment
    let address = stevens_exp.is_hybrid ? ADDRESS_BASE + &quot;/hybrid_trial&quot; : ADDRESS_BASE + &quot;/stevens_trial&quot;;

    var trial = {
      type:&apos;d3-plot-keyboard-response&apos;,
      block_type: block_type,
      url: address,
      choices: [77, 90, 32, 81],  // m = 77 (up), z = 90 (down), 32 = spacebar, 81 = q (exit button for debugging)
      execute_script: true,
      response_ends_trial: true,
      plot_distributions: plot_distributions,
      print_curr_trial: print_curr_trial,
      order: &quot;stevens&quot;,
      exp_obj: stevens_exp, 
      data: {},
      on_start: function(trial){ // NOTE: on_start takes in trial var
        stevens_exp.display_mode = &quot;trial&quot;; 
        // Set the constants to be used:
        let index = stevens_exp.getIndex(block_type); 
        let constants = stevens_exp.getConstants(block_type,index);
        trial.trial_duration = constants.regen_rate;
        //console.log(constants)
        if (block_type == &quot;test&quot;){
          stevens_exp.practice_end = true;
        }
        // Retrieve data from last trial:
        var last_stevens_trial = stevens_exp.get_last_trial(trial, block_type, index);
        // Handling saving the data: 
        stevens_exp.handle_data_saving(trial, block_type, constants, estimated_correlation, last_stevens_trial, index);
        // Set the estimated correlation
        var estimated_correlation = stevens_exp.update_estimated_correlation(trial, constants, last_stevens_trial, block_type);
        console.log(&quot;round refreshes: &quot; + trial.data.round_refreshes);
        console.log(&quot;trial/round num: &quot; + trial.data.trial_num);
        console.log(&quot;num adjustments: &quot; + trial.data.num_adjustments);
        if(block_type === &quot;test&quot;){
          console.log(&quot;input count per trial: &quot; + stevens_exp.input_count_array);
        }
        else{
          console.log(&quot;Practice input count per trial: &quot; + stevens_exp.practice_input_count_array);
        }
        
        stevens_exp.num_trial_complete = trial.data.trial_num;
        // Generate distributions
                var high_coordinates = generate_adjusted_distribution(constants, constants.high_ref)
        
        var low_coordinates = generate_adjusted_distribution(constants, constants.low_ref)
        
        var estimated_coordinates = generate_adjusted_distribution(constants, estimated_correlation)
        
        // If there is a distractor population, generate it:
        if (stevens_exp.condition_group === &quot;distractor&quot;) {
          stevens_exp.generate_distractor_coordinates(constants);
        }

        // Randomize position of the high and low correlated graphs for a given round
        if (trial.data.round_refreshes == 1){
          console.log(&quot;Randomizing Position&quot;)
          var result = randomize_position(trial, 
                                          high_coordinates,
                                          low_coordinates, 
                                          constants.high_ref, 
                                          constants.low_ref);
          trial.data.high_ref_is_right = result.base_is_right;
        }

        if (trial.data.high_ref_is_right){
          stevens_exp.right_coordinates = high_coordinates;
          stevens_exp.left_coordinates = low_coordinates;
          stevens_exp.coordinates = [low_coordinates, estimated_coordinates, high_coordinates];
        }
        else{
          stevens_exp.right_coordinates = low_coordinates;
          stevens_exp.left_coordinates = high_coordinates;
          stevens_exp.coordinates = [high_coordinates, estimated_coordinates, low_coordinates];
        }

        stevens_exp.trial_data = trial.data; 
        trial.exp_obj = stevens_exp;

        console.log(&quot;[RIGHT] Correlation: &quot; + trial.data.right_correlation);
        console.log(&quot;[MIDPOINT] Correlation: &quot; + trial.data.estimated_mid);
        console.log(&quot;[LEFT] Correlation: &quot; + trial.data.left_correlation);
      },
      on_finish: function(data){
        // Set Trial End to 1 here for correct summary data
        if (stevens_exp.end_round()){
          data.type = &quot;stevens&quot;;
          data.trial_end = 1;
        }
      }
    };
  

    return trial; 
  }

    /**
 * Generates conditional timeline instruction for JND and Stevens hybrid conditions.
 * @returns {jsPsych trial}
 */
 genereate_hybrid_instruction(){
  let stevens_exp = this;
  let number_of_subconditions = stevens_exp.sub_conditions_constants;
  let instructions = `&lt;div align = &apos;center&apos;&gt;
                        &lt;p&gt; Please exit full screen mode and switch to the JND Task.
                          &lt;br&gt; Do not close this window. You will return to it when the JND Task is completed.
                          &lt;br&gt; Enter full screen mode again and press any key to continue when you return.
                        &lt;/p&gt;
                      &lt;/div&gt;`

  let instruction_trial = {
    type: &apos;html-keyboard-response&apos;,
    stimulus: instructions,
    on_finish: function (data){
      if (stevens_exp.current_sub_condition_index &lt; (stevens_exp.sub_conditions_constants.length - 1)) {
        stevens_exp.input_count_array = new Array(stevens_exp.sub_conditions_constants[stevens_exp.current_sub_condition_index].trials_per_round).fill(0);

        stevens_exp.current_sub_condition_index++;
        console.log(&quot;!!!!!!!!!! Moved to new sub condition at index &quot; + stevens_exp.current_sub_condition_index);
      }
      else{
        stevens_exp.end_experiment = true;
      } 
    }
  };

  // conditional timeline wrapper
  let block_size = 1;
  var hybrid_timeline = {
    timeline: [instruction_trial],
    conditional_function: function() {
      
      // if it is the end of the Sub Condition and the end of a block (assumes block size is 3 for hybrid tasks)
      if (stevens_exp.end_round() &amp;&amp; stevens_exp.end_sub_condition(&quot;test&quot;, stevens_exp.current_sub_condition_index) 
      &amp;&amp; (stevens_exp.current_sub_condition_index + 1) % block_size == 0 &amp;&amp; (stevens_exp.current_sub_condition_index + 1) % 2 != 0) {
        return true;
      } else {
        return false;
      }
    }
  };

  return hybrid_timeline
}


  /**
   * Will generate the distractor coordinates and save them to the instance.
   *
   * @param  {object}  constants (for the given trial)       
   */
  generate_distractor_coordinates(constants) {
    let dist_attributes = constants.dist_attributes;
    let dist_correlation = constants.dist_attributes.correlation;
    let left_dist_coordinates = generate_adjusted_distribution(dist_attributes, dist_correlation);
    let middle_dist_coordinates = generate_adjusted_distribution(dist_attributes, dist_correlation);
    let right_dist_coordinates = generate_adjusted_distribution(dist_attributes, dist_correlation);
    this.distractor_coordinates = [left_dist_coordinates, middle_dist_coordinates, right_dist_coordinates];
  }

  /**
   * Retrieves the last stevens trial depending on block_type for a
   * given sub condition index. 
   * If this is the first trial of a given block_type, returns null. 
   *
   * @param  trial {object}   
   *         block_type {string}          &quot;test&quot; or &quot;practice&quot;         
   *         index {integer}
   * @return last_stevens_trial {object}           
   */
  get_last_trial(trial, block_type, index) {

    var last_stevens_trial; 
    trial.data.type = &quot;stevens&quot;;
    
    // Set trial run_type depending on block type
    // (we need to set trial&apos;s run_type so we can do the filter in the
    // next if block)
    if (block_type == &quot;test&quot;){
      trial.data.run_type = &quot;test&quot;;
    }
    else{
      trial.data.run_type = &quot;practice&quot;;
    }

    // Retrieve previous stevens trial if it exists
    if (block_type == &quot;practice&quot; &amp;&amp; jsPsych.data.get().filter({type: &quot;stevens&quot;, run_type: &quot;practice&quot;, sub_condition: index}).last(1).values()[0]){
      last_stevens_trial = jsPsych.data.get().filter({type: &quot;stevens&quot;, run_type: &quot;practice&quot;, sub_condition: index}).last(1).values()[0];
    }
    else if (block_type == &quot;test&quot; &amp;&amp; jsPsych.data.get().filter({type: &quot;stevens&quot;, run_type: &quot;test&quot;, sub_condition: index}).last(1).values()[0]){
      last_stevens_trial = jsPsych.data.get().filter({type: &quot;stevens&quot;, run_type: &quot;test&quot;, sub_condition: index}).last(1).values()[0];
    }
    else{
      last_stevens_trial = null;
    }

    return last_stevens_trial; 
  }

  /**
   * Handles saving the relevant data on a given trial.
   *
   * For reference, these are the helper variables created to assist in trial logic (i.e not present in excel)
   * this.trial_variables =         
   *       {type: &apos;stevens&apos;,
   *       run_type: &apos;&apos;,
   *       left_correlation: &apos;&apos;,
   *       right_correlation: &apos;&apos;,
   *       round_refreshes: 0,      // Number of times there is a refresh for a given round 
   *       high_ref_is_right: false
   *       start_ref: &apos;&apos;
   *       };
   *
   * These are variables created WITHIN the trial logic that were not present in excel (but need to be
   * outputted to results).         
   * this.export_variables = 
   *       {trial_num: 0,                // Round index trial is currently on (aka trial_num from excel)
   *        sub_condition: &apos;&apos;,           // Chronological ordering of sub_condition [1, 2, 3 ... ]
   *        balanced_sub_condition: &apos;&apos;,  // Index of sub_condition according to balancing order
   *        estimated_mid: &apos;&apos;,
   *        num_adjustments: 0,          // Number of inputs for a given round (aka num_adjustments from excel)
   *        trials_per_round: &apos;&apos;,
   *       };
   *
   * @param trial {object}
   *        block_type {string}               &quot;test&quot; or &quot;practice&quot;
   *        constants {assoc array}
   *        estimated_correlation {double}
   *        last_stevens_trial {object}
   *        index {integer}
   */
  handle_data_saving(trial, block_type, constants, estimated_correlation, last_stevens_trial, index) {

    trial.data = Object.assign({}, trial.data, constants);
    trial.data.constants = constants;
    trial.data.sub_condition = index;
    trial.data.balanced_sub_condition = this.sub_condition_order[index];

    //trial.trial_duration = trial.data.regen_rate;
    
    // If trial is still part of same sub-condition, carry over constants from
    // the previous trial
    //if (last_stevens_trial &amp;&amp; !this.hybrid_2nd_practice){
    if (last_stevens_trial){ // commenting out old hybrid logic (pre combined hybrid timeline)
      trial.data.step_size = last_stevens_trial.step_size;
      trial.data.right_correlation = last_stevens_trial.right_correlation;
      trial.data.left_correlation = last_stevens_trial.left_correlation;
      trial.data.high_ref_is_right = last_stevens_trial.high_ref_is_right;
      // Else trial_num, num_adjustments and start_ref is the same, but round_refresh ++
      //console.log(&quot;Round End: &quot;, this.round_end)
      if (this.round_end){
        trial.data.type = &quot;stevens&quot;;
        last_stevens_trial.trial_end = 1;
        trial.data.trial_num = last_stevens_trial.trial_num + 1;
        trial.data.num_adjustments = 0;
        trial.data.round_refreshes = 1;
        console.log(&quot;Start Ref: &quot;, last_stevens_trial.start_ref)
        if (last_stevens_trial.start_ref === (constants.starting_high_ref ? constants.starting_high_ref : constants.high_ref)) {
          trial.data.start_ref = constants.starting_low_ref ? constants.starting_low_ref : constants.low_ref;
        } else {
          trial.data.start_ref = constants.starting_high_ref ? constants.starting_high_ref : constants.high_ref;
        }
        this.round_end = false; //Reset flag
      } 
      else{
        trial.data.trial_end = 0;
        trial.data.trial_num = last_stevens_trial.trial_num;
        trial.data.num_adjustments = last_stevens_trial.num_adjustments;
        trial.data.start_ref = last_stevens_trial.start_ref;
        trial.data.round_refreshes = last_stevens_trial.round_refreshes + 1;
      }
    }
    // Else this is the first refresh of a given trial 
    else{
      trial.data.trial_end = 0;
      trial.data.trial_num = 0;
      trial.data.num_adjustments = 0;
      trial.data.round_refreshes = 1;
      this.hybrid_2nd_practice = false;
    }
  }

  /**
   * Updates the estimated correlation.
   * If  : 
   *    Is the first trial, will initialize the correlation and step size.
   * Else:
   *    If there was a key press in previous trial, will calculate the
   *    the estimated correlation (depending on whether it was an inc or dec).
   *    Else if no key press in previous trial, will set estimated correlation
   *    to the previous trial&apos;s. 
   *
   * @param  trial {object}   
   *         constants {object}         
   *         last_trial {object}
   * @return estimated_correlation {double}           
   */
  update_estimated_correlation(trial, constants, last_trial, block_type) {

    var estimated_correlation;
    var index = this.current_sub_condition_index;

    // If first trial (estimated_correlation is null), so initialize
    // estimated midpoint and set step size:
    if (trial.data.round_refreshes == 1){
  
      //Initialize the estimated midpoint correlation:
      //estimated_correlation = Math.random() &lt; 0.5 ? constants.low_ref : constants.high_ref;
      estimated_correlation = trial.data.start_ref;
      console.log(estimated_correlation)
      trial.data.estimated_mid = estimated_correlation;
      trial.data.step_size = (constants.high_ref - constants.low_ref) / this.MAX_STEP_INTERVAL;

    }
    // If there is input on PREVIOUS trial, change the midpoint + increment trial number
    // (Since we are plotting the new middle graph based on PREVIOUS input, we look
    // at the last_trials&apos;s estimated_correlation and step size.)
    else if (last_trial.key_press &amp;&amp; (last_trial.key_press == trial.choices[0] || last_trial.key_press == trial.choices[1])){

      // Need to check that if hits either high or low ref, it DOESN&apos;T count as a num_adjustment
      let is_unchanged = false;

      switch (last_trial.key_press){

        case trial.choices[0]: // up

          estimated_correlation = Math.min(constants.high_ref, last_trial.estimated_mid + (Math.random() * last_trial.step_size));
          
          // If they&apos;ve hit the max (high_ref)
          if (estimated_correlation === constants.high_ref) {
            is_unchanged = true;
          }
          break;

        case trial.choices[1]: // down

          estimated_correlation = Math.max(constants.low_ref, last_trial.estimated_mid - (Math.random() * last_trial.step_size));
          
          // If they&apos;ve hit the min (low_ref)
          if (estimated_correlation === constants.low_ref) {
            is_unchanged = true;
          }
          break;
      }

      // For valid changes (i.e not going beyond max or below min), can then 
      // increment num_adjustments
      if (!is_unchanged){
        trial.data.num_adjustments = last_trial.num_adjustments + 1;
        if(block_type === &quot;test&quot;){
          this.input_count_array[trial.data.trial_num]++;
        }
        else{
          this.practice_input_count_array[trial.data.trial_num]++;
        }
      }  

    }

    // Else use the previous trial&apos;s midpoint
    else{

      // QUESTION: If there is user input, on the next viz, the graph will display 
      // that estimated correlation. However, AFTER that, we are changing the 
      // estimated correlation??

      // Based on StevensTrial.java (line 75), the estimated midpoint gets updated this way:
      // var prev_constants = this.sub_conditions_constants[current_sub_condition_index-1];
      // if (last_trial.estimated_correlation == prev_constants.high_ref){
      //   estimated_midpoint = constants.low_ref;
      // }
      // else{
      //   estimated_midpoint = constants.high_ref;
      // }

      estimated_correlation = last_trial.estimated_mid;
    }

    // Update the trial&apos;s estimated_mid
    trial.data.estimated_mid = estimated_correlation;

    return estimated_correlation;
  }

  /**
   * Determines whether the round can end or not. A round can end ONLY if
   * there has been at least 1 input from the user on the given round 
   *
   * @return {boolean}            True if sub condition should end.
   */
  end_round() {
    let last_trial = jsPsych.data.get().last(1).values()[0];
    let space_bar_pressed = 32 == last_trial.key_press;
    return (space_bar_pressed &amp;&amp; last_trial.num_adjustments &gt; 0);
  }

  /**
   * Determines whether the current sub condition can end or not.
   * 
   * @return {boolean}            True if sub condition should end.
   */
  end_sub_condition(block_type,index) {
    let trials_per_round;
    switch(block_type){
      case &quot;test&quot;:
        trials_per_round = this.sub_conditions_constants[index].trials_per_round;
        if (this.input_count_array[trials_per_round - 1] == 0){ 
          return false;
        }
        return true;
        break;
      case &quot;practice&quot;:
        trials_per_round = this.practice_conditions_constants[index].trials_per_round;
        if (this.practice_input_count_array[trials_per_round - 1] == 0){ 
          return false;
        }
        console.log(&quot;RESETTING ARRAY !!!!!!!!!!&quot;)
        // Reset array
        this.practice_input_count_array = new Array(this.practice_conditions_constants[index].trials_per_round).fill(0);
        return true;
        break;
    }
  }


  /**
   * When called, will save individual trial data into a CSV.     
   */
  export_trial_data() {
    var summary_data = [];

    let screening_json = jsPsych.data.get().filter({trial_type: &apos;survey-html-form&apos;}).select(&apos;responses&apos;).values[0]
    // Participant information
    // indexing might need to be genralized better if there are previous trials before the start of the experiment
    if(screening_json){
      console.log(&apos;Saving Screening&apos;)
      let screening_responses = JSON.parse(screening_json)
      let screening_data = {};
      screening_data.education = screening_responses[2].value
      screening_data.stat_classes_take = screening_responses[3].value
      screening_data.vision = screening_responses[4].value
      screening_data.gender = screening_responses[5].value
      screening_data.age = screening_responses[6].value
      summary_data.push(screening_data);
    }


    summary_data = summary_data.concat(this.get_summary_data())


    var trial_data = jsPsych.data.get().filter(this.is_hybrid?{type: &apos;stevens&apos;}:{type: &apos;stevens&apos;, run_type: &apos;test&apos;})
                                       .filterCustom(function(x){ //Don&apos;t include the exit trials
                                         return x.correct != -1;
                                       })
                                       .filterCustom(function(x){ //Don&apos;t include trials with no user input
                                        return x.rt != null;
                                        })
                                       .filterCustom(function(x){ //Don&apos;t include trivial trials 
                                        return x.trial_end != 0;
                                        })
                                        .filterCustom(function(x){ //Don&apos;t include trivial trials 
                                          return x.num_adjustments != 0;
                                          })
                                         // Steven&apos;s trial variables
                                       .ignore(&apos;type&apos;)
                                       .ignore(&apos;run_type&apos;)
                                       .ignore(&apos;left_correlation&apos;)
                                       .ignore(&apos;right_correlation&apos;)
                                       .ignore(&apos;round_refreshes&apos;)
                                       .ignore(&apos;high_ref_is_right&apos;)
                                       .ignore(&apos;constants&apos;)
                                       .ignore(&apos;last_stevens_trial&apos;)
                                       // These are variables forced on by jsPsych
                                       .ignore(&apos;stimulus&apos;)
                                       .ignore(&apos;key_press&apos;)
                                       .ignore(&apos;choices&apos;)
                                       .ignore(&apos;trial_end&apos;)
                                       .ignore(&apos;trial_type&apos;)
                                       .ignore(&apos;trial_index&apos;)
                                       .ignore(&apos;time_elapsed&apos;)
                                       .ignore(&apos;internal_node_id&apos;);
                                       

    if(this.is_local_save === &quot;true&quot;){
      // TEMPORARY: test file save locally 
      var string = &quot;S&quot; + this.subject_id + &quot;_&quot; + this.condition_name + &quot;_stevens_trial_results.csv&quot;;
      trial_data.localSave(&apos;csv&apos;, string); 
    }
    else{
      trial_data = JSON.parse(trial_data.json());
      var data = summary_data.concat(trial_data);
      data = JSON.stringify(data);
  
      //Firebase upload
      $.post(&quot;/api/experiment_data&quot;,
              {trial_data: trial_data, summary_data: summary_data, experiment: &quot;Stevens&quot;, condition: params[&quot;condition&quot;], prolific_pid: params[&quot;subject_id&quot;], study_id: params[&quot;study_id&quot;], session_id: params[&quot;session_id&quot;]},
              function(data, status) {
                console.log(&quot;Data: &quot; + data + &quot;\nStatus: &quot; + status)
              }
            );
    }                                      
  }

  get_summary_data(){
    let summary_data = []
    const condition_num = this.sub_conditions_constants.length;
    for (let i = 0; i&lt;condition_num ; i++){
      let summary_data_sub = this.get_summary_data_sub(i);
      console.log(summary_data_sub)
      summary_data.push(summary_data_sub);
    }
    return summary_data;
  }

  get_summary_data_sub(i){
    var constants = this.sub_conditions_constants[i];   
    var mean_estimated_mid_values = this.compute_mean(this.estimated_mid_values[i]);
    console.log(this.estimated_mid_values[i])

    var summary_data_sub = {&quot;high_ref&quot;:constants.high_ref,&quot;low_ref&quot;:constants.low_ref,
                            &quot;estimated_midpoint&quot;:mean_estimated_mid_values,&quot;trials&quot;:constants.trials_per_round};
    if(constants.block){
      summary_data_sub.block = constants.block
    }
    return summary_data_sub;
  }

  /**
   * When called, will save aggregated trial data into a CSV.     
   */
  export_summary_data() {
    var is_save = confirm(&quot;Would you like to save the test summary?&quot;);
    if (is_save == false){
        return;
    }

    var csv = &apos;SUBJECT_ID,SUBJECT_INITIALS,ROUND_TYPE,NUM_TRIALS,HIGH_REF,ESTIMATED_MIDPOINT,LOW_REF\n&apos;;

    var data = [];
    
    // Organize each row of the csv
    for (let i = 0; i&lt;this.sub_conditions_constants.length; i++){
      var row = [];
      var constants = this.sub_conditions_constants[i];
      var mean_estimated_mid_values = this.compute_mean(this.estimated_mid_values[i]);

      row.push(this.subject_id);
      row.push(this.subject_initials);
      row.push(constants.round_type);
      row.push(constants.trials_per_round);
      row.push(constants.high_ref);
      row.push(mean_estimated_mid_values);
      row.push(constants.low_ref);  

      data.push(row);
    }

    // Append each row
    data.forEach(function(row){
      csv += row.join(&apos;,&apos;);
      csv += &quot;\n&quot;;
    });

    var hiddenElement = document.createElement(&apos;a&apos;);
    hiddenElement.href = &apos;data:text/csv;charset=utf-8,&apos; + encodeURI(csv);
    hiddenElement.target = &apos;_blank&apos;;
    hiddenElement.download = &quot;S&quot; + this.subject_id + &quot;_&quot; + this.condition_name + &quot;_stevens_summary_results.csv&quot;;
    hiddenElement.click();
  }

   /**
   * Determines the mean or average of a given array input.
   * 
   * @param {object} inputArray 
   * @return {integer} mean value
   */
  compute_mean(inputArray){
    var sum = 0;
    var length = inputArray.length;
    for (var i = 0; i &lt; inputArray.length; i++){
      sum += inputArray[i];
    }
    return sum / length;
  }

  /**
   * Returns the block type&apos;s constants.
   * @param {string} block_type 
   * @param {int} index 
   * @returns 
   */
  getConstants(block_type,index){
    if(block_type === &quot;practice&quot;){
      return this.practice_conditions_constants[index]
    }
    if(block_type === &quot;test&quot;){
      return this.sub_conditions_constants[index]
    }
  }

  /**
   * 
   * @param {string} block_type 
   * @returns 
   */
  getIndex(block_type){
    if(block_type === &quot;practice&quot;){
      return this.curr_practice_condition_index;
    }
    if(block_type === &quot;test&quot;){
      return this.current_sub_condition_index;
    }
  }

}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
