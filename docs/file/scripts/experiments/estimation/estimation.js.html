<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">scripts/experiments/estimation/estimation.js | vcl-web-framework</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<script src="./inject/script/0-conditions-config.js"></script><script src="./inject/script/0-experiments-config.js"></script><script src="./inject/script/0-graphing-config.js"></script><script src="./inject/script/0-trial-structure-config.js"></script><script src="./inject/script/0-balancing-config.js"></script><script src="./inject/script/0-view-controller.js"></script><script src="./inject/script/0-experiments-renderer.js"></script><script src="./inject/script/0-conditions-renderer.js"></script><script src="./inject/script/0-supported-properties-renderer.js"></script><link rel="stylesheet" href="./inject/css/0-styles.css"><meta name="description" content="This is a Node.js application that runs correlation-related experiments of the VCL Lab."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="vcl-web-framework"><meta property="twitter:description" content="This is a Node.js application that runs correlation-related experiments of the VCL Lab."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/UBC-VCL/VCLWebFramework.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing">experiment-properties/balancing</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-balance_subconditions">balance_subconditions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing-balancing-helpers">experiment-properties/balancing/balancing_helpers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_index_array">generate_index_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_any_array">get_any_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_any_array_repeated">get_any_array_repeated</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_permutation">get_permutation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_remaining_elements">get_remaining_elements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-heapsPermute">heapsPermute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-reorder">reorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-shuffle">shuffle</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing-generators">experiment-properties/balancing/generators</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_blocked_latin_square">initialize_blocked_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-innitialize_custom_latin_square">innitialize_custom_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_counter_balanced_order">generate_counter_balanced_order</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-innitialize_custom_order">innitialize_custom_order</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_latin_square">initialize_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_random_order">initialize_random_order</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-counter">experiment-properties/counter</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-print_curr_trial">print_curr_trial</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-data">experiment-properties/data</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_custom_subcondition">get_custom_subcondition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_condition_dataset">create_condition_dataset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_design_condition_dataset">create_design_condition_dataset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_data">get_data</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_data_subset">get_data_subset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CUSTOM_TRIAL_STRUCTURE_CONDITIONS">CUSTOM_TRIAL_STRUCTURE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EXPERIMENT_BASES">EXPERIMENT_BASES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EXPERIMENT_CONDITIONS">EXPERIMENT_CONDITIONS</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-data-constants">experiment-properties/data/constants</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENSEMBLE_AVERAGE_BASE">ENSEMBLE_AVERAGE_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENSEMBLE_AVERAGE_CONDITIONS">ENSEMBLE_AVERAGE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ESTIMATION_CONDITIONS">ESTIMATION_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYBRID_BASE">HYBRID_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYBRID_CONDITIONS">HYBRID_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_BASE">JND_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_CONDITIONS">JND_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_RADIUS_BASE">JND_RADIUS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_RADIUS_CONDITIONS">JND_RADIUS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NUMEROSITY_BASE">NUMEROSITY_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NUMEROSITY_CONDITIONS">NUMEROSITY_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_BASE">SEQUENCING_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_CONDITIONS">SEQUENCING_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SIDE_BY_SIDE_BASE">SEQUENCING_SIDE_BY_SIDE_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SIDE_BY_SIDE_CONDITIONS">SEQUENCING_SIDE_BY_SIDE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SYMBOLS_BASE">SEQUENCING_SYMBOLS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SYMBOLS_CONDITIONS">SEQUENCING_SYMBOLS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STEVENS_BASE">STEVENS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STEVENS_CONDITIONS">STEVENS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VISUAL_SEARCH_BASE">VISUAL_SEARCH_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VISUAL_SEARCH_CONDITIONS">VISUAL_SEARCH_CONDITIONS</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-distribution">experiment-properties/distribution</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_adjusted_distribution">generate_adjusted_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_initial_distribution">generate_initial_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_random_distribution">generate_random_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-correlationNotWithinError">correlationNotWithinError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateDistribution">generateDistribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomGaussian">generateRandomGaussian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getPearsonCorrelation">getPearsonCorrelation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pointNotWithinRequiredStdDevs">pointNotWithinRequiredStdDevs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_coordinates">prepare_coordinates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-random_bm">random_bm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readjustPoints">readjustPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transformPoints">transformPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomDistribution">generateRandomDistribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomUniform">generateRandomUniform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateUniformDistribution">generateUniformDistribution</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing">experiment-properties/graphing</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_color">generate_color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_color_hex">generate_color_hex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_custom_plot">is_custom_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_custom_plot">prepare_custom_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add_graph_features">add_graph_features</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_attributes_object">generate_attributes_object</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_distributions">plot_distributions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-base-plots">experiment-properties/graphing/d3-base-plots</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_parallel_plot">create_parallel_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_ring_plot">create_ring_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_scatter_plot">create_scatter_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_scatter_points">plot_scatter_points</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_shape_plot">create_shape_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_strip_plot">create_strip_plot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-custom-plots">experiment-properties/graphing/d3-custom-plots</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_distractor_scatter_plot">create_distractor_scatter_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_bisection_plot">create_estimation_bisection_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_interference_plot">create_estimation_interference_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_multi_interference_plot">create_estimation_multi_interference_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_plot">create_estimation_plot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-plot-features">experiment-properties/graphing/d3-plot-features</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-combine_target_and_distractor">combine_target_and_distractor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_mixed_attribute_graph">plot_mixed_attribute_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_array_mix_graph">prepare_array_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_mix_graph">prepare_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_targeted_mix_graph">prepare_targeted_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_visual_mask_graph">prepare_visual_mask_graph</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-instructions">experiment-properties/instructions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_subcond_instruction_block">generate_subcond_instruction_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_instructions">get_instructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_jspsych_instructions">get_jspsych_instructions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-instruction-screen">experiment-timeline/instruction_screen</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_instructions">generate_instructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_ready_screen">generate_ready_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_sitting_distance_screen">generate_sitting_distance_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_welcome">generate_welcome</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-resolution-scaling">experiment-timeline/resolution_scaling</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-manual_resolution_scaling">manual_resolution_scaling</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resolution_scaling">resolution_scaling</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-screening">experiment-timeline/screening</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningInstructions">screeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningPCPInverted">screeningPCPInverted</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-instructionsRegression">instructionsRegression</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningCorrelationSelect">screeningCorrelationSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningCorrelationSort">screeningCorrelationSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningInstructions">screeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningQuestions">screeningQuestions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningRegressionSelect">screeningRegressionSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-colorScreeningInstructions">colorScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ignoreScreeningInstructions">ignoreScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-luminanceScreeningInstructions">luminanceScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-orientationScreeningInstructions">orientationScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningStripColorYellowBlue">screeningStripColorYellowBlue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screenningStripLuminanceSort">screenningStripLuminanceSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screenningStripOrientationSort">screenningStripOrientationSort</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-ensemble-average">experiments/ensemble_average</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/ensemble_average/ensemble_average.js~Ensemble_Average.html">Ensemble_Average</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ensemble_avg_exp">ensemble_avg_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-estimation">experiments/estimation</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/estimation/estimation.js~Estimation.html">Estimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-estimation_exp">estimation_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-hybrid">experiments/hybrid</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/hybrid/hybrid.js~Hybrid.html">Hybrid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hybrid_exp">hybrid_exp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_exp">jnd_exp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stevens_exp">stevens_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-jnd">experiments/jnd</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/jnd/jnd.js~JND.html">JND</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_block">generate_experiment_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_end">generate_experiment_end</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_screen">generate_feedback_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_block">generate_practice_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_ready_experiment">generate_ready_experiment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_stop_block">generate_stop_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_exp">jnd_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-jnd-radius">experiments/jnd_radius</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/jnd_radius/jnd_radius.js~JND_Radius.html">JND_Radius</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_radius_exp">jnd_radius_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-numerosity">experiments/numerosity</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/numerosity/numerosity.js~Numerosity.html">Numerosity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-numerosity_exp">numerosity_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing">experiments/sequencing</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing/sequencing.js~Sequencing.html">Sequencing</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IMAGE_PATH">IMAGE_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_exp">sequencing_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing-side-by-side">experiments/sequencing_side_by_side</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing_side_by_side/sequencing_side_by_side.js~Sequencing_Side_by_Side.html">Sequencing_Side_by_Side</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IMAGE_PATH">IMAGE_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_side_by_side_exp">sequencing_side_by_side_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing-symbols">experiments/sequencing_symbols</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing_symbols/sequencing_symbols.js~Sequencing_Symbols.html">Sequencing_Symbols</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment">generate_experiment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_end">generate_experiment_end</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_screen">generate_feedback_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_wrapper">generate_feedback_wrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_block">generate_practice_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_instruction_block">generate_practice_instruction_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_stop_practice_trials">generate_stop_practice_trials</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECTANGLE_MASK_PATH">RECTANGLE_MASK_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SQUARE_MASK_PATH">SQUARE_MASK_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_symbols_exp">sequencing_symbols_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-stevens">experiments/stevens</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/stevens/stevens.js~Stevens.html">Stevens</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stevens_exp">stevens_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-visual-search">experiments/visual_search</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/visual_search/visual_search_timeline.js~Visual_Search.html">Visual_Search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_color_paths">get_color_paths</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hex_to_color">hex_to_color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-visual_search_exp">visual_search_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#helpers">helpers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/helpers/correlation_dependencies.js~Correlation_Dependencies.html">Correlation_Dependencies</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-above_and_below_generate_random_trial_array">above_and_below_generate_random_trial_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-bundle_z_values">bundle_z_values</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-check_params">check_params</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-force_greater_right_position">force_greater_right_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feature_search_trials">generate_feature_search_trials</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_timeline_screen">generate_timeline_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-genereate_hybrid_instruction">genereate_hybrid_instruction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getScreenHeight">getScreenHeight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_mixed_graph_styles">get_mixed_graph_styles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_mixed_masks">get_mixed_masks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_num_blocks">get_num_blocks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_running_average">get_running_average</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_single_graph_style">get_single_graph_style</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_single_mask">get_single_mask</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_converged_in_window">is_converged_in_window</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nova_variables">nova_variables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_graph_attributes_mixed">randomize_graph_attributes_mixed</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_position">randomize_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_position_symmetric">randomize_position_symmetric</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_radius_position">randomize_radius_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-repeat_y_values">repeat_y_values</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-shuffleArray">shuffleArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-correlation_dependencies">correlation_dependencies</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">scripts/experiments/estimation/estimation.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import {balance_subconditions} from &quot;/scripts/experiment-properties/balancing/balancing_controller.js&quot;;
import {get_data} from &quot;/scripts/experiment-properties/data/data_controller.js&quot;;
import {randomize_position,
        randomize_radius_position,
        force_greater_right_position} from &quot;/scripts/helpers/experiment_helpers.js&quot;;

export default class Estimation {
    /**
     * Initializes a Estimation experiment object.
     *
     * @param  params          {object}    Parameters passed in from routing
     */
    constructor(params) {

        let trial_structure = params[&quot;trial_structure&quot;];
        let condition_name = params[&quot;condition&quot;];
        let graph_type = params[&quot;graph_type&quot;];
        let balancing_type = params[&quot;balancing&quot;];

        // **NOTE: EXPERIMENTS variable comes from /public/config/experiments-config.js
        if (!EXPERIMENTS[&quot;estimation&quot;][&quot;trial_structure&quot;].includes(trial_structure)) {
          throw Error(trial_structure + &quot; is not supported.&quot;);}
        else {
          this.trial_structure = trial_structure;
        }

        if (!EXPERIMENTS[&quot;estimation&quot;][&quot;graph_type&quot;].includes(graph_type)){
          throw Error(graph_type + &quot; is not supported.&quot;)} 
        else { 
          this.graph_type = graph_type;
        };  

        if (!EXPERIMENTS[&quot;estimation&quot;][&quot;balancing_type&quot;].includes(balancing_type)) {
          throw Error(balancing_type + &quot; is not supported.&quot;) }
        else {
          this.balancing_type = balancing_type;
        }  

        this.condition_name = condition_name;
        this.subject_id = params[&quot;subject_id&quot;];
        this.subject_initials = params[&quot;subject_initials&quot;];

        // ========================================
        // EXPERIMENT CONSTANTS
        this.X_DISTANCE_BETWEEN_SHAPES = 12;
        this.Y_DIVIATION_FROM_X_AXIS = 3;
        this.MAX_STEP_INTERVAL = 10;
        this.ROUNDS_PER_COND = 4;
        this.MAX_Y_POS_JITTER = 0.1; // y axis can be shifted away from default (window / 2) by at most 0.1 * ImageHeight;
        this.MAX_STEP_SIZE = 0.05; // how much can the size of shapes can be changed at one keypress

        // PIXELS_PER_CM is defined in estimation_experiment.html
        if (PIXELS_PER_CM) {
            this.PIXEL_TO_CM = PIXELS_PER_CM;
        } else {
            // 1cm is 37.7952755906 pixels
            this.PIXEL_TO_CM = 37.7952755906;
            throw Error(&quot;PIXELS_PER_CM is not defined&quot;);
        }

        // Margin from top and bottom of screen is set to at least 5cm
        this.MARGIN = 5;
        // ========================================
        // EXPERIMENT VARIABLES
        this.input_count_array= [0, 0, 0, 0];
        this.curr_round_num = 0;
        this.curr_condition_index = 0; // pointing to positions in this.curr_conditions_constants
        this.is_practice = true;
        // input_count_array has length equals to trials_per_round, each index representing num inputs per round
        // for a given sub condition
        this.curr_conditions_constants; // array of sub-conditions currently running
        this.raw_sub_conds; // subconditions in estimation_data.js

        this.curr_condition_index; // pointing to positions in this.curr_conditions_constants
        this.round_end = true;
        this.interf_shape_variables = {};

        // ========================================
        // PRACTICE EXPERIMENT VARIABLES

        this.adjusted_midpoint_matrix = {};
        this.practice_trial_data = [];
        this.practice_end = false;

        // ========================================
        // TEST EXPERIMENT VARIABLES
        this.sub_condition_order;

        // ========================================
        // CURRENT TRIAL DATA
        this.curr_trial_data = {};

        this.results = []; // trials are pushed to results at the end of trial;
        // ========================================
        // PREPARE EXPERIMENT

        // Extract raw constants
        // this.raw_sub_conds = generate_estimation_experiment_data(params.condition);
        this.raw_sub_conds = get_data(this);
        // console.log(&quot;raw sub conds&quot;);
        // Prepare experiment + practice data
        this.practice_conditions_constants = [];
        this.curr_conditions_constants = []; // array of sub-conditions currently running

        this.experiment_conditions_constants = [];
        this.prepare_experiment();
        this.prepare_practice();
    }

    /**
     * Orders the input data according to balancing type and
     * initializes the Estimation object&apos;s variables.
     *
     */
    prepare_experiment() {
        let dataset = this.raw_sub_conds;
        
        this.sub_condition_order = balance_subconditions(this.balancing_type, this.constructor.name.toLowerCase(), dataset.length);

        let ordered_dataset = [];
        // Order the data set according to the randomly ordered array
        for (let i = 0; i &lt; this.sub_condition_order.length; i++) {
            ordered_dataset[i] = dataset[this.sub_condition_order[i]];
        }
        // Set experiment trials
        this.experiment_conditions_constants = ordered_dataset;
    }

    /**
     * Creates the practice dataset by taking the first FOUR subconditions.
     *
     */
    prepare_practice() {
        let dataset = this.raw_sub_conds;
        let practice_dataset = [];

        for (let i = 0; i &lt; 1; i++){
            practice_dataset[i] = dataset[i];
            this.practice_trial_data[i] = [];
        }
        // set variables to practice
        this.practice_conditions_constants = practice_dataset;
        this.curr_conditions_constants = practice_dataset;
        this.curr_condition_index = 0;
        this.current_practice_condition_index = 0;
        this.input_count_array = new Array(this.curr_conditions_constants[0].trials_per_round).fill(0);
        this.is_practice = true;
    }

    /**
     * Resets all relevant variables to use that of the experiment.
     * (input_count_array, curr_conditions_constants, and curr_condition_index
     * are shared variables between the practice and test trials).
     *
     * This function is called once all the practice trials have run.
     */
    set_variables_to_experiment() {
        console.log(&quot;set_variables_to_experiment&quot;);
        this.curr_conditions_constants = this.experiment_conditions_constants;
        this.curr_condition_index = 0;
        this.curr_round_num = 0;
        this.input_count_array = new Array(this.curr_conditions_constants[0].trials_per_round).fill(0);
        this.is_practice = false;
    }

    /**
     * Generates a Estimation object for use in the JsPsych timeline.
     *
     * @param  block_type {string}     &quot;test&quot; or &quot;practice&quot;
     * @return trial {object}
     */
    generate_trial(block_type) {

        if ((block_type !== &quot;test&quot;) &amp;&amp; (block_type !== &quot;practice&quot;)) {
            throw Error(block_type + &quot; is not supported.&quot;)
        }
       // Initialize a variable for this so it is usable inside on_start
        var estimation_exp = this;
        var address = location.protocol + &quot;//&quot; + location.hostname + &quot;:&quot; + location.port + &quot;/estimation_trial&quot;;

        let group = {};
        let is_ref_left = false;
        let ready = {
            type: &apos;html-keyboard-response&apos;,
            choices: [32, &apos;q&apos;],
            stimulus: &quot;&quot;,
            on_start: function(trial) {
                is_ref_left = Math.random() &gt; 0.5;
                trial.stimulus = &quot;&quot;;
                trial.stimulus += is_ref_left? &quot;&lt;div align = &apos;center&apos;&gt;&lt;font size = 20&gt;&quot; +
                    &quot;&lt;p&gt;The modifiable shape will be on the &lt;b&gt;right.&lt;/b&gt;&lt;p&gt;&quot; +
                    &quot;&lt;br&gt; &lt;br&gt; &lt;p&gt;&lt;b&gt;Press space to continue.&lt;/b&gt;&lt;/p&gt;&lt;/font&gt;&lt;/div&gt;&quot; :
                    &quot;&lt;div align = &apos;center&apos;&gt;&lt;font size = 20&gt;&quot; +
                    &quot;&lt;p&gt;The modifiable shape will be on the &lt;b&gt;left.&lt;/b&gt;&lt;p&gt;&quot; +
                    &quot;&lt;br&gt; &lt;br&gt; &lt;p&gt;&lt;b&gt;Press space to continue.&lt;/b&gt;&lt;/p&gt;&lt;/font&gt;&lt;/div&gt;&quot; ;
            },
            data: {type: &apos;instruction&apos;}
        };
        let trial = {
            type:&apos;external-html-keyboard-response&apos;,
            url: address,
            choices: [32, &apos;q&apos;],  // 32 = spacebar, 81 = q (exit button for debugging)
            execute_script: true,
            response_ends_trial: true,
            data: {
                round_num: 0,
                estimated_size: -1,
                adjustments: [], // array of numbers representing the adjustments made to the shape
                sub_condition_index: 0,
                block_type: block_type
            },
            on_start: function(trial) {
                console.log(&quot;====================on_start=======================&quot;);
                // Set the constants to be used:
                let current_constants = estimation_exp.curr_conditions_constants[estimation_exp.curr_condition_index];
                console.log(current_constants);
                trial.data.sub_condition_index = estimation_exp.curr_condition_index;
                trial.data.round_num = estimation_exp.curr_round_num;
                trial.data = Object.assign({}, trial.data);
                trial.data = Object.assign(trial.data, current_constants);
                trial.data.is_ref_left = is_ref_left; // is the reference shape on the left

                // Handing saving for data that is an assoc array
                if (current_constants.mod_side_shapes &amp;&amp; current_constants.ref_side_shapes) {

                    trial.data.mod_side_shape_mod = current_constants.mod_side_shapes.mod;
                    trial.data.mod_side_shape_ref = current_constants.mod_side_shapes.ref;

                    trial.data.ref_side_shape_main = current_constants.ref_side_shapes.main;
                    trial.data.ref_side_shape_sub = current_constants.ref_side_shapes.sub;

                    delete trial.data.mod_side_shapes;
                    delete trial.data.ref_side_shapes;
                }

                if (current_constants.flicker_ref_durations) {
                    trial.data.flicker_ref_duration_on = current_constants.flicker_ref_durations.on;
                    trial.data.flicker_ref_duration_off = current_constants.flicker_ref_durations.off;

                    delete trial.data.flicker_ref_durations;
                }

                estimation_exp.curr_trial_data = trial.data;

                // Save trial data for practice so can calculate exclusion criteria
                if (trial.data.run_type === &quot;practice&quot;) {
                    estimation_exp.practice_trial_data[estimation_exp.curr_condition_index].push(trial.data);
                }
                // console.log(JSON.stringify(trial));
            },
            on_finish: function(data) { // NOTE: on_finish takes in data var
                // save data here
                console.log(&quot;====================on_finish=======================&quot;);

                // Save estimated ratio at end of round
                console.log(&quot;REF SHAPE AREA: &quot; + data.ref_shape_area);
                console.log(&quot;ESTIMATED AREA: &quot; + data.estimated_area);

                // Assumption is that the ref ratio does small val/big val --&gt; so need
                // to do same when computing estimated ratio
                if (data.ref_shape_area &gt;= data.estimated_area) {
                  data.estimated_ratio = data.estimated_area / data.ref_shape_area;
                } else {
                  data.estimated_ratio = data.ref_shape_area / data.estimated_area;
                }

                let curr_trial_data = JSON.parse(JSON.stringify((data)));
                estimation_exp.results.push(curr_trial_data);
                estimation_exp.update_curr_round_number(data);
                estimation_exp.update_curr_cond_idx(data);
                estimation_exp.update_input_array(data);
            }
        };
        if (this.condition_name === &quot;absolute_area_ratio_bisection_variant_A&quot; ||
            this.condition_name === &quot;absolute_area_ratio_bisection_variant_B&quot;){
          group.timeline = [trial];
        } else {
          group.timeline = [ready, trial];
        }

        return group;
    }

    /**
     * Set the current trial&apos;s number of inputs in the input_count_array
     * @param data {object} the trial.data object from jsPsych
     * */
    update_input_array(data) {
        if (data.round_num &lt; 0 || data.round_num &gt; 3) {
            throw Error(&quot;trail number : &quot; + data.round_num + &quot; is out of range&quot;);
        }
        this.input_count_array[data.round_num] = data.adjustments.length;
    }

    /**
     * Update the current round number
     * @param trial_data {object} the trial.data object from jsPsych
     * */
    update_curr_round_number(trial_data) {
        if (trial_data.round_num === this.ROUNDS_PER_COND - 1) {
            this.curr_round_num  = 0;
        } else {
            this.curr_round_num++;
        }
    }

    /**
     * Update the index of the condition that is being referred to
     * @param trial_data {object} the trail.data object from jsPsych
     * */
    update_curr_cond_idx(trial_data) {
        if (trial_data.round_num === this.ROUNDS_PER_COND - 1) {
            this.curr_condition_index++;
        }
    }

    /**
     * Appends the adjustment to the curr_trial_data.adjustments.
     *
     * @param {double}   adjustment
     */
    save_adjustment(adjustment) {
      this.curr_trial_data.adjustments.push(adjustment);
    }

    /**
     * Saves the estimated size to the curr_trial_data.
     *
     * @param {double}   estimated_size
     *        {string}   unit of the estimated_size
     */
    save_estimated_size(estimated_size, unit) {
      this.curr_trial_data.estimated_size = estimated_size;
      this.curr_trial_data.estimated_size_unit = unit;
      // console.log(&quot;ESTIMATED SIZE: &quot; + estimated_size);
    }

    /**
     * Saves the estimated area to the curr_trial_data.
     *
     * @param {double}   area
     *        {string}   unit of the estimated_area
     */
    save_estimated_area(area) {
      this.curr_trial_data.estimated_area = area;
      // console.log(&quot;ESTIMATED AREA: &quot; + area);
    }

    /**
     * Saves and computes the ref shape area to the curr_trial_data.
     *
     * - For normal estimation conditions (AKA one shape on mod and one shape on ref side),
     *   will use the single shape on the ref side
     * - For multi interference conditions, is using the main shape on the mod side
     * - For interference conditions, is using the single shape on ref side
     * - For bisection conditions, it is taking the midpoint between the left and right reference shape areas
     *
     * @param {object}   attributes
     */
    save_reference_shape_area(attributes) {
      let name_array = this.condition_name.split(&quot;_&quot;);
      let ref_shape_attributes, area;

      if (name_array.includes(&quot;interference&quot;)) {
        if (name_array.includes(&quot;multi&quot;)){

          // Taking main shape on mod side 
          ref_shape_attributes = this.curr_trial_data.is_ref_left ? attributes.right_shape : attributes.left_shape;
          area = this.compute_shape_area(ref_shape_attributes.shape, ref_shape_attributes.size);

        } else {
          ref_shape_attributes = this.curr_trial_data.is_ref_left ? attributes.left_shape : attributes.right_shape;
          area = this.compute_shape_area(ref_shape_attributes.shape, ref_shape_attributes.size);
        }
      }
      else if (name_array.includes(&quot;bisection&quot;)) {

        let left_area = this.compute_shape_area(attributes.left_shape.shape, attributes.left_shape.size);
        let right_area = this.compute_shape_area(attributes.right_shape.shape, attributes.right_shape.size);
        area = (left_area + right_area) / 2;

      } else {

        ref_shape_attributes = this.curr_trial_data.is_ref_left ? attributes.left_shape : attributes.right_shape;
        area = this.compute_shape_area(ref_shape_attributes.shape, ref_shape_attributes.size);

      }

      this.curr_trial_data.ref_shape_area = area;
    }

    /**
     * Computes the area for a given shape and the size. 
     *
     * @param  {string}   shape
     *         {string}   size   (in pixels)
     *
     * @return {double}  area   (in CM^2)
     */
    compute_shape_area(shape, size) {
      let area;

      switch (shape) {
        case &quot;square&quot;: {
          let length = size / this.PIXEL_TO_CM;
          area = length * length;
        } break;

        case &quot;triangle&quot; : { //Assuming equilateral for now
          let length = size / this.PIXEL_TO_CM;
          area = (Math.sqrt(3)/4)*(length*length);
        } break; 

        case &quot;circle&quot; : {
          let radius = (size / 2) / this.PIXEL_TO_CM;  //Size = diameter
          area = Math.PI*(radius*radius);
        } break;

        case &quot;line&quot; : {
          let length = size / this.PIXEL_TO_CM;
          let width = 1 / this.PIXEL_TO_CM; //Assuming stroke-width is 1px 
          area = length * width;
        } break;

        case &quot;rectangle&quot; : {
          let short_side = size / this.PIXEL_TO_CM;
          let long_side = short_side * this.curr_trial_data.width_height_ratio;
          area = short_side * long_side;
        } break;

        default:
          throw Error(&quot;Handling for computing area for shape &quot; + shape + &quot; has not been implemented.&quot;);
          break;
      }
      return area;
    }

    /**
     * Computes the area for a fan.
     *
     * @param  {double}   angle  (in degrees)
     *         {double}   radius (in pixels)
     *
     * @return {double}  area   (in CM^2)
     */
    compute_fan_area(angle, radius) {
      let radius_in_cm = radius / this.PIXEL_TO_CM;
      let area = Math.PI*(radius_in_cm*radius_in_cm)*(angle/360); // A = pi*r^2*(C/360)

      return area;
    }

    /**
     * Computes attributes for all estimation plots.
     *
     * @param {object}   experiment
     */
    compute_plot_attributes() {

      let sub_cond = this.curr_conditions_constants[this.curr_condition_index];
      let round_num = this.curr_round_num;

      // ----------------------------------------------------------------------------
      // COMPUTATION FOR ATTRIBUTES

      // Disable jitter for multi interference conditions
      let is_jitter = this.condition_name.split(&quot;_&quot;).includes(&quot;multi&quot;) ? false : true;

      let width = window.innerWidth;
      let height = window.innerHeight;

      let mid_width = width / 2;
      let mid_height = height / 2;

      let left_x = mid_width - this.X_DISTANCE_BETWEEN_SHAPES * this.PIXEL_TO_CM / 2;
      let right_x = mid_width + this.X_DISTANCE_BETWEEN_SHAPES * this.PIXEL_TO_CM / 2;

      let ref_size = sub_cond.ref_size * this.PIXEL_TO_CM ;
      let ref_y = this.calculate_y_position(ref_size, is_jitter);

      // The size of the modifiable shape start from mod_min_size for trial 0 and 2, mod_max_size for 1 and 3;
      let mod_size = (round_num % 2 === 1)?
          sub_cond.mod_max_size * this.PIXEL_TO_CM  : sub_cond.mod_min_size * this.PIXEL_TO_CM;
      let mod_y = this.calculate_y_position(mod_size, is_jitter);

      let is_ref_left = this.curr_trial_data.is_ref_left;

      let flicker_options;
      if (sub_cond.flicker_ref_durations) {
        flicker_options = {&quot;flicker&quot;: {on: sub_cond.flicker_ref_durations.on, off: sub_cond.flicker_ref_durations.off}};
      }

      this.curr_trial_data.is_ref_smaller = (round_num % 2 === 1);

      // ----------------------------------------------------------------------------
      // ATTRIBUTE SET-UP

      let attributes = {
        chart: {
          width:             width,
          height:            height,
          target_area_ratio: sub_cond.target_area_ratio ? sub_cond.target_area_ratio : null
        },
        core: {
          ref_size:   ref_size,
          ref_y:      ref_y,
          mod_size:   mod_size,
          mod_y:      mod_y,
          left_size:  is_ref_left ? ref_size : mod_size,
          right_size: is_ref_left ? mod_size : ref_size, 
        },
        left_shape: {
          shape:      is_ref_left ? sub_cond.ref_shape   : sub_cond.mod_shape,
          size:       is_ref_left ? ref_size             : mod_size,
          x:          left_x,
          y:          is_ref_left ? ref_y                : mod_y,
          outline:    is_ref_left ? sub_cond.ref_outline : sub_cond.mod_outline,
          fill:       is_ref_left ? sub_cond.ref_fill    : sub_cond.mod_fill,
          is_ref:     is_ref_left ? true                 : false,
          options:    is_ref_left ? flicker_options      : null
        },
        right_shape: {
          shape:      is_ref_left ? sub_cond.mod_shape   : sub_cond.ref_shape,
          size:       is_ref_left ? mod_size             : ref_size,
          x:          right_x,
          y:          is_ref_left ? mod_y                : ref_y,
          outline:    is_ref_left ? sub_cond.mod_outline : sub_cond.ref_outline,
          fill:       is_ref_left ? sub_cond.mod_fill    : sub_cond.ref_fill,
          is_ref:     is_ref_left ? false                : true,
          options:    is_ref_left ? null                 : flicker_options
        }
      }

      // ----------------------------------------------------------------------------
      // ADD&apos;L ATTRIBUTE PREP FOR INTERFERENCE CONDITIONS

      let name_array = this.condition_name.split(&quot;_&quot;);

      if (name_array.includes(&quot;interference&quot;)) {
        
        if (name_array.includes(&quot;multi&quot;)) {
          attributes = this.compute_estimation_multi_interference_attributes(sub_cond, attributes);
        }
        else {
          attributes = this.compute_estimation_interference_attributes(sub_cond, attributes);
        }

      } 
      else if (name_array.includes(&quot;bisection&quot;)) {
        attributes = this.compute_bisection_attributes(sub_cond, attributes);
      }

      this.save_reference_shape_area(attributes);
      return attributes;
    }

    /**
     * Computes attributes for bisection conditions (AKA has &quot;bisection&quot; in condition name).
     *
     * @param {object}   sub_cond
     *        {object}   attributes
     */
    compute_bisection_attributes(sub_cond, attributes) {

      let x_adjustment = this.X_DISTANCE_BETWEEN_SHAPES * this.PIXEL_TO_CM / 4;
      
      let mid_width = window.innerWidth / 2;
      let mid_height = window.innerHeight / 2;

      // Alternate left/right of the sizes depending on trial number
      let left_size, right_size;
      if (this.curr_round_num % 2 === 1) {
        left_size = sub_cond.ref_size[1];
        right_size = sub_cond.ref_size[0];
      } else {
        left_size = sub_cond.ref_size[0];
        right_size = sub_cond.ref_size[1];
      }

      let flicker_options;
      if (sub_cond.flicker_ref_durations) {
        flicker_options = {&quot;flicker&quot;: {on: sub_cond.flicker_ref_durations.on, off: sub_cond.flicker_ref_durations.off}};
      }

      attributes.left_shape = {
          shape:      sub_cond.ref_shape[0],
          size:       left_size * this.PIXEL_TO_CM,
          x:          attributes.left_shape.x -= x_adjustment,
          y:          this.calculate_y_position(sub_cond.ref_size[0] * this.PIXEL_TO_CM, false),
          outline:    sub_cond.ref_outline,
          fill:       sub_cond.ref_fill,
          is_ref:     true,
          options:    flicker_options
      };

      attributes.right_shape = {
          shape:      sub_cond.ref_shape[1],
          size:       right_size * this.PIXEL_TO_CM,
          x:          attributes.right_shape.x += x_adjustment,
          y:          this.calculate_y_position(sub_cond.ref_size[1] * this.PIXEL_TO_CM, false),
          outline:    sub_cond.ref_outline,
          fill:       sub_cond.ref_fill,
          is_ref:     true,
          options:    flicker_options
      };

      attributes.middle_shape = {
          shape:      sub_cond.mod_shape,
          size:       sub_cond.mod_max_size * this.PIXEL_TO_CM, //doesn&apos;t matter if use max or min, they are set to be same
          x:          mid_width,
          y:          this.calculate_y_position(sub_cond.mod_max_size * this.PIXEL_TO_CM, false),
          outline:    sub_cond.mod_outline,
          fill:       sub_cond.mod_fill,
          is_ref:     false,
          options:    null
      }

      return attributes;
    }

    /**
     * Computes attributes for single-interference conditions (AKA no &quot;multi&quot; in condition name).
     *
     * @param {object}   sub_cond
     *        {object}   attributes
     */
    compute_estimation_interference_attributes(sub_cond, attributes) {

      // Only prep attributes on sub_cond with interf variables
      if (sub_cond.interf_shape &amp;&amp; sub_cond.interf_fill &amp;&amp; sub_cond.interf_outline &amp;&amp; sub_cond.interf_ratio) {

        let is_ref_left = this.curr_trial_data.is_ref_left;

        let interf_radius = attributes.core.mod_size * sub_cond.interf_ratio;
        let interf_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
        let interf_y_pos = attributes.core.mod_y + attributes.core.mod_size*0.1;

        if (sub_cond.mod_shape === &quot;triangle&quot; &amp;&amp; sub_cond.interf_shape === &quot;circle&quot;) {
            interf_radius = interf_radius * 2;
        } 
        
        attributes.interf_shape = {
          shape:    sub_cond.interf_shape,
          size:     interf_radius,
          x:        interf_x_pos,
          y:        interf_y_pos,
          outline:  sub_cond.interf_outline,
          fill:     sub_cond.interf_fill,
          is_ref:   true,
          options:  {&quot;scaling&quot;: &quot;scales_with_mod&quot;}
        }

        return attributes;

      } else {

        return attributes;
      }
    }

    /**
     * Computes attributes for multi-interference conditions (AKA has &quot;multi&quot; in condition name).
     *
     * @param {object}   sub_cond
     *        {object}   attributes
     */
    compute_estimation_multi_interference_attributes(sub_cond, attributes) {

      if (!sub_cond.mod_side_shapes    || !sub_cond.mod_ratio       || !sub_cond.interf_fill || !sub_cond.interf_outline ||
          !sub_cond.mod_side_alignment || !sub_cond.ref_side_shapes || !sub_cond.ref_ratio   || !sub_cond.ref_side_alignment) {
          throw Error(&quot;Missing attributes to run a multi-interference condition.&quot;);
      }

      let is_ref_left = this.curr_trial_data.is_ref_left;

      // ----------------------------------------------------------------------------
      // FORCE LEFT/RIGHT SHAPES TO BE BASED ON REF-SIDE-MAIN AND MOD-SIDE-REF 

      let left_shape  = is_ref_left ? sub_cond.ref_side_shapes.main : sub_cond.mod_side_shapes.ref;
      let right_shape = is_ref_left ? sub_cond.mod_side_shapes.ref : sub_cond.ref_side_shapes.main;

      attributes.left_shape.shape  = left_shape; // Overwrite attributes
      attributes.right_shape.shape = right_shape;

      // Main shapes are automatically &quot;ref&quot;
      attributes.left_shape.is_ref = true;
      attributes.right_shape.is_ref = true;

      // ----------------------------------------------------------------------------
      // COMPUTE ATTRIBUTES FOR NON-MAIN SHAPES + PLOT

      // Buffer to ensure shapes on ref and mod sides don&apos;t overlap with each other
      let x_buffer = 3 * this.PIXEL_TO_CM; // 3 CM buffer
      attributes.right_shape.x += x_buffer;
      attributes.left_shape.x  -= x_buffer;

      this.append_ref_sub_attributes(sub_cond, attributes, is_ref_left);
      this.append_mod_attributes(sub_cond, attributes, is_ref_left);

      console.log(attributes);

      return attributes;
    }

    /**
     * For 2 shapes S1 and S2, with an area ratio of S1:S2, computes the length
     * for S2 to maintain this area ratio.
     *
     * @param {string}   S1_shape_type    
     *        {double}   S1_length        (in pixels) 
     *        {double}   S1_S2_area_ratio (S1 area / S2 area)         
     *        {string}   S2_shape_type
     *
     * @return {double}  S2_length        (in pixels)
     */
    calculate_length_from_area_ratio(S1_shape_type, S1_length, S1_S2_area_ratio, S2_shape_type) {

      // Compute area (in CM^2) of the initial_length
      let S1_area = this.compute_shape_area(S1_shape_type, S1_length);
      let S2_area = S1_area * (1/S1_S2_area_ratio);

      let S2_length_cm = this.compute_shape_length(S2_shape_type, S2_area);

      console.log(&quot;RATIO: &quot; + S1_S2_area_ratio);
      console.log(&quot;S1 LENGTH: &quot; + S1_length / this.PIXEL_TO_CM);
      console.log(&quot;S1 AREA: &quot; + S1_area);
      console.log(&quot;S2 LENGTH: &quot; + S2_length_cm);
      console.log(&quot;S2 AREA: &quot; + S2_area);

      return S2_length_cm * this.PIXEL_TO_CM;
    }

    /**
     * Computes the shape length with the specified area.
     *
     * @param {string}   shape_type     
     *        {double}   target area
     *
     * @return {double}  length
     */
    compute_shape_length(shape_type, area) {

      let length;

      switch (shape_type) {
        case &quot;square&quot; : {
          length = Math.sqrt(area);
        } break;

        case &quot;triangle&quot; : { //Assume equilateral for now
          let inner = (4*area)/Math.sqrt(3);
          length = Math.sqrt(inner);
        } break;

        case &quot;circle&quot; : {
          let radius = Math.sqrt(area/Math.PI);
          length = radius*2; //Return diameter b/c plotting code assumes it is taking diameter
        } break;

        default: 
          throw Error (&quot;Computations for determining length from area for shape &quot; + shape_type + &quot; has not been implemented.&quot;);
          break;
      }

      return length;
    }

    /**
     * Computes attributes for the sub shape on the ref side for multi interference conditions.
     * Additionally adjusts the main shape on the ref side depending on the alignment.
     *
     * @param {object}   sub_cond
     *        {object}   attributes
     *        {boolean}  is_ref_left
     */
    append_ref_sub_attributes(sub_cond, attributes, is_ref_left) {

      let ref_radius, ref_x_pos, ref_y_pos;
      let options = {};

      switch (sub_cond.ref_side_alignment) {

        case &quot;overlapping-bottom&quot;: {

          let main_ref_shape_type = is_ref_left ? attributes.left_shape.shape : attributes.right_shape.shape;
          ref_radius = this.calculate_length_from_area_ratio(main_ref_shape_type, attributes.core.ref_size, sub_cond.ref_ratio, sub_cond.ref_side_shapes.sub);

          // Same x as main shape
          ref_x_pos = is_ref_left ? attributes.left_shape.x : attributes.right_shape.x;
          // Shift down to bottom of main shape
          ref_y_pos = attributes.core.ref_y - (ref_radius - attributes.core.ref_size)/2;

        } break;

        case &quot;vertical-left&quot;: {
          
          let main_ref_shape_type = is_ref_left ? attributes.left_shape.shape : attributes.right_shape.shape;
          ref_radius = this.calculate_length_from_area_ratio(main_ref_shape_type, attributes.core.ref_size, sub_cond.ref_ratio, sub_cond.ref_side_shapes.sub);

          let x_pos_main_ref = is_ref_left ? attributes.left_shape.x : attributes.right_shape.x;
          ref_x_pos = x_pos_main_ref + ref_radius/2 - attributes.core.ref_size/2;
          ref_y_pos = attributes.core.ref_y + ref_radius/2 + attributes.core.ref_size * 0.5 + this.PIXEL_TO_CM * 2;

          // Shift up so ref shapes are centered horizontally
          let y_buffer = ((ref_y_pos + 0.5 * ref_radius) - (attributes.core.ref_y + 0.5 * attributes.core.left_size)) / 2;
          ref_y_pos = ref_y_pos - y_buffer;

          // Main ref shape needs to move up as well
          if (is_ref_left) {
            attributes.left_shape.y -= y_buffer;
          } else {
            attributes.right_shape.y -= y_buffer;
          }

        } break;   

        case &quot;vertical-left-cutout&quot;: {

          if (sub_cond.ref_side_shapes.sub === &quot;square&quot;) {

            let main_ref_shape_type = is_ref_left ? attributes.left_shape.shape : attributes.right_shape.shape;
            ref_radius = this.calculate_length_from_area_ratio(main_ref_shape_type, attributes.core.ref_size, sub_cond.ref_ratio, sub_cond.ref_side_shapes.sub);

            let x_pos_main_ref = is_ref_left ? attributes.left_shape.x : attributes.right_shape.x;
            ref_x_pos = x_pos_main_ref + ref_radius/2 - attributes.core.ref_size/2;
            ref_y_pos = attributes.core.ref_y + ref_radius/2 + attributes.core.ref_size * 0.5 + this.PIXEL_TO_CM * 2;

            // Shift up so ref shapes are centered horizontally
            let y_buffer = ((ref_y_pos + 0.5 * ref_radius) - (attributes.core.ref_y + 0.5 * attributes.core.left_size)) / 2;
            ref_y_pos = ref_y_pos - y_buffer;

            // Main ref shape needs to move up as well
            if (is_ref_left) {
              attributes.left_shape.y -= y_buffer;
            } else {
              attributes.right_shape.y -= y_buffer;
            }

            let main_ref_size = is_ref_left ? attributes.left_shape.size : attributes.right_shape.size;
            options = {&quot;cutout_radius&quot; :  main_ref_size};

          } else {
            throw Error(sub_cond.ref_side_shapes.sub + &quot; shape has not been handled for vertical-left-cutout side alignment.&quot;);
          }

        } break;

        case &quot;vertical-centered&quot;: {

          if (sub_cond.ref_side_shapes.sub === &quot;fan&quot;) {
            // Same radius and x pos
            ref_radius = is_ref_left ? attributes.left_shape.size : attributes.right_shape.size;
            ref_x_pos = is_ref_left ? attributes.left_shape.x : attributes.right_shape.x;  

            // Shift up 
            ref_y_pos = attributes.core.ref_y - ref_radius - this.PIXEL_TO_CM * 2;

            let angle_size = 360/(1/sub_cond.ref_ratio);
            options = {&quot;fan-attributes&quot;: {&quot;slice-alignment&quot;: &quot;top&quot;, &quot;angle_size&quot;: angle_size}};
          }
          else {
            throw Error(sub_cond.ref_side_shapes.sub + &quot; shape has not been handled for vertical-centered ref side alignment.&quot;);
          }

        } break;

        default: 
          throw Error(sub_cond.ref_side_alignment + &quot; ref side alignment is not supported.&quot;);
      }  

      if (sub_cond.flicker_ref_durations){
        options.flicker = {on: sub_cond.flicker_ref_durations.on, off: sub_cond.flicker_ref_durations.off};
      }

      attributes.ref_sub_shape = {
                                    shape:    sub_cond.ref_side_shapes.sub,
                                    size:     ref_radius,
                                    x:        ref_x_pos,
                                    y:        ref_y_pos,
                                    outline:  sub_cond.interf_outline,
                                    fill:     sub_cond.interf_fill,
                                    is_ref:   true,
                                    options:  options
                                  };
    }

    /**
     * Computes attributes for the modifiable shape for multi interference conditions.
     * Additionally adjusts the main shape on the mod side depending on the alignment.
     *
     * @param {object}   sub_cond
     *        {object}   attributes
     *        {boolean}  is_ref_left
     */
    append_mod_attributes(sub_cond, attributes, is_ref_left) {

      let mod_radius, mod_x_pos, mod_y_pos, options;

      switch (sub_cond.mod_side_alignment) {

        case &quot;overlapping-center&quot;: {

          if (sub_cond.mod_side_shapes.mod === &quot;fan&quot;) {
              mod_radius = attributes.core.mod_size;
              mod_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
              mod_y_pos = attributes.core.mod_y - 0.25*(mod_radius); 

              let angle_size = 360/(1/sub_cond.mod_ratio);
              options = {&quot;fan-attributes&quot;: {&quot;slice-alignment&quot;: &quot;bottom&quot;, &quot;angle_size&quot;: angle_size}};
          } else {
              
              let sub_shape_type = is_ref_left ? attributes.right_shape.shape : attributes.left_shape.shape;
              mod_radius = this.calculate_length_from_area_ratio(sub_shape_type, attributes.core.mod_size, sub_cond.mod_ratio, sub_cond.mod_side_shapes.mod);

              mod_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
              mod_y_pos = attributes.core.mod_y;
              options = {&quot;scaling&quot;: &quot;scales_indep&quot;};
          }

        } break;

        case &quot;diagonal&quot;: {

          let sub_shape_type = is_ref_left ? attributes.right_shape.shape : attributes.left_shape.shape;
          mod_radius = this.calculate_length_from_area_ratio(sub_shape_type, attributes.core.mod_size, sub_cond.mod_ratio, sub_cond.mod_side_shapes.mod);
          
          mod_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
          mod_y_pos = attributes.core.mod_y;
          options = null;

          // Shift down
          let y_shift = sub_cond.mod_ratio &lt; 1 ? mod_radius : (mod_radius*1.5 + this.PIXEL_TO_CM * 2);

          // Manipulate alignment for main shapes on mod side
          if (is_ref_left) {
              attributes.right_shape.x += mod_radius;
              attributes.right_shape.y -= y_shift;
          } else {
              attributes.left_shape.x += mod_radius;
              attributes.left_shape.y -= y_shift;
          }

        } break;

        case &quot;overlapping-bottom&quot;: {

          if (sub_cond.mod_side_shapes.mod === &quot;fan&quot;) {
            mod_radius = attributes.core.mod_size;
            mod_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
            mod_y_pos = attributes.core.mod_y;

            let angle_size = 360/(1/sub_cond.mod_ratio);
            options = {&quot;fan-attributes&quot;: {&quot;slice-alignment&quot;: &quot;bottom&quot;, &quot;angle_size&quot;: angle_size}};
          }
          else {
              throw Error(sub_cond.mod_side_shapes.mod + &quot; shape has not been handled for overlapping-bottom mod side alignment.&quot;);
          }

        } break;

        case &quot;overlapping-bottom-edge&quot;: {

          if (sub_cond.mod_side_shapes.mod === &quot;fan&quot;) {
            mod_radius = attributes.core.mod_size;
            mod_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
            mod_y_pos = attributes.core.mod_y + mod_radius/4; // Shift down 1/4 of circle

            let angle_size = 360/(1/sub_cond.mod_ratio);
            options = {&quot;fan-attributes&quot;: {&quot;slice-alignment&quot;: &quot;bottom&quot;, &quot;angle_size&quot;: angle_size}};
          }
          else {
              throw Error(sub_cond.mod_side_shapes.mod + &quot; shape has not been handled for overlapping-bottom-edge mod side alignment.&quot;);
          }

        } break;

        case &quot;slice-bottom&quot;: {

          if (sub_cond.mod_side_shapes.mod === &quot;fan&quot;) {
            mod_radius = attributes.core.mod_size;
            mod_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
            mod_y_pos = attributes.core.mod_y + mod_radius/4; // Shift down 1/4 of circle

            let angle_size = 360/(1/sub_cond.mod_ratio);
            options = {&quot;fan-attributes&quot;: {&quot;slice-alignment&quot;: &quot;bottom&quot;, &quot;angle_size&quot;: angle_size, &quot;ref_shape_adjusts&quot;: true}};
          }
          else {
              throw Error(sub_cond.mod_side_shapes.mod + &quot; shape has not been handled for slice-bottom mod side alignment.&quot;);
          }

        } break;

        case &quot;overlapping-top-left-corner&quot;: {

          if (sub_cond.mod_side_shapes.mod === &quot;square&quot;) {
            let sub_shape_type = is_ref_left ? attributes.right_shape.shape : attributes.left_shape.shape;
            mod_radius = this.calculate_length_from_area_ratio(sub_shape_type, attributes.core.mod_size, sub_cond.mod_ratio, sub_cond.mod_side_shapes.mod);

            // This centers it
            mod_x_pos = is_ref_left ? attributes.right_shape.x : attributes.left_shape.x;
            mod_y_pos = attributes.core.mod_y;

            // Moves it to top left
            let diff = attributes.core.mod_size - mod_radius*2;
            mod_x_pos -= diff;
            mod_y_pos -= diff;

          } else {
            throw Error(sub_cond.mod_side_shapes.mod + &quot; shape has not been handled for overlapping-top-left-corner mod side alignment.&quot;);
          }
        } break;

        default: 
            throw Error(sub_cond.mod_side_alignment + &quot; is not supported.&quot;);

      }

      attributes.mod_shape = {
                              shape: sub_cond.mod_side_shapes.mod,
                              size: mod_radius,
                              x: mod_x_pos,
                              y: mod_y_pos,
                              outline: sub_cond.interf_outline,
                              fill: sub_cond.interf_fill,
                              is_ref: false,
                              options: options
                            }

    }


    /**
     * Calculates the y value of the position where the shape should be plotted
     *
     * @param   {number}  radius the radius of the shape
     * @param   {boolean} whether to jitter the y pos or not
     *
     * @returns {number}
     */
    calculate_y_position(radius, with_jitter) {
        // y_margin is the distance from
        let y_margin = this.MARGIN * this.PIXEL_TO_CM;
        // pick a random position inside the screen such the the shapes will not be displayed outside of the border
        let range = [y_margin + radius / 2, window.innerHeight - y_margin - radius / 2];
        let y_pos;
        if (with_jitter) {
            y_pos = Math.random() * (range[1] - range[0]) + range[0];
        } else {
            y_pos = (range[1] + range[0]) / 2;
        }
        return y_pos;
    }

    /*
    * Saves experiment data as csv
    * */
    export_trial_data() {
        let trial_data = jsPsych.data.get().filterCustom(function (row) {
            return row.block_type === &quot;practice&quot; || row.block_type === &quot;test&quot;;
        })
        // These are variables forced on by jsPsych
            .ignore(&apos;stimulus&apos;)
            .ignore(&apos;key_press&apos;)
            .ignore(&apos;choices&apos;)
            .ignore(&apos;trial_type&apos;)
            .ignore(&apos;trial_index&apos;)
            .ignore(&apos;time_elapsed&apos;)
            .ignore(&apos;internal_node_id&apos;)
            .ignore(&apos;rt&apos;);

        let fileName = &quot;S&quot; + this.subject_id + &quot;_&quot; + this.condition_name + &quot;_shape_estimation_trial_results.csv&quot;;

        trial_data.localSave(&apos;csv&apos;, fileName);
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
