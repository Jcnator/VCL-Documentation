<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">scripts/experiments/jnd/jnd.js | vcl-web-framework</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<script src="./inject/script/0-conditions-config.js"></script><script src="./inject/script/0-experiments-config.js"></script><script src="./inject/script/0-graphing-config.js"></script><script src="./inject/script/0-trial-structure-config.js"></script><script src="./inject/script/0-balancing-config.js"></script><script src="./inject/script/0-view-controller.js"></script><script src="./inject/script/0-experiments-renderer.js"></script><script src="./inject/script/0-conditions-renderer.js"></script><script src="./inject/script/0-supported-properties-renderer.js"></script><link rel="stylesheet" href="./inject/css/0-styles.css"><meta name="description" content="This is a Node.js application that runs correlation-related experiments of the VCL Lab."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="vcl-web-framework"><meta property="twitter:description" content="This is a Node.js application that runs correlation-related experiments of the VCL Lab."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/UBC-VCL/VCLWebFramework.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing">experiment-properties/balancing</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-balance_subconditions">balance_subconditions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing-balancing-helpers">experiment-properties/balancing/balancing_helpers</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_index_array">generate_index_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_any_array">get_any_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_any_array_repeated">get_any_array_repeated</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_permutation">get_permutation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_remaining_elements">get_remaining_elements</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-heapsPermute">heapsPermute</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-reorder">reorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-shuffle">shuffle</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-balancing-generators">experiment-properties/balancing/generators</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_blocked_latin_square">initialize_blocked_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-innitialize_custom_latin_square">innitialize_custom_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_counter_balanced_order">generate_counter_balanced_order</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-innitialize_custom_order">innitialize_custom_order</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_latin_square">initialize_latin_square</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initialize_random_order">initialize_random_order</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-counter">experiment-properties/counter</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-print_curr_trial">print_curr_trial</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-data">experiment-properties/data</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_custom_subcondition">get_custom_subcondition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_condition_dataset">create_condition_dataset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_design_condition_dataset">create_design_condition_dataset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_data">get_data</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_data_subset">get_data_subset</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CUSTOM_TRIAL_STRUCTURE_CONDITIONS">CUSTOM_TRIAL_STRUCTURE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EXPERIMENT_BASES">EXPERIMENT_BASES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EXPERIMENT_CONDITIONS">EXPERIMENT_CONDITIONS</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-data-constants">experiment-properties/data/constants</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENSEMBLE_AVERAGE_BASE">ENSEMBLE_AVERAGE_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENSEMBLE_AVERAGE_CONDITIONS">ENSEMBLE_AVERAGE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ESTIMATION_CONDITIONS">ESTIMATION_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYBRID_BASE">HYBRID_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYBRID_CONDITIONS">HYBRID_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_BASE">JND_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_CONDITIONS">JND_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_RADIUS_BASE">JND_RADIUS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-JND_RADIUS_CONDITIONS">JND_RADIUS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NUMEROSITY_BASE">NUMEROSITY_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NUMEROSITY_CONDITIONS">NUMEROSITY_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_BASE">SEQUENCING_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_CONDITIONS">SEQUENCING_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SIDE_BY_SIDE_BASE">SEQUENCING_SIDE_BY_SIDE_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SIDE_BY_SIDE_CONDITIONS">SEQUENCING_SIDE_BY_SIDE_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SYMBOLS_BASE">SEQUENCING_SYMBOLS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SEQUENCING_SYMBOLS_CONDITIONS">SEQUENCING_SYMBOLS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STEVENS_BASE">STEVENS_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STEVENS_CONDITIONS">STEVENS_CONDITIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VISUAL_SEARCH_BASE">VISUAL_SEARCH_BASE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-VISUAL_SEARCH_CONDITIONS">VISUAL_SEARCH_CONDITIONS</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-distribution">experiment-properties/distribution</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_adjusted_distribution">generate_adjusted_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_initial_distribution">generate_initial_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_random_distribution">generate_random_distribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-correlationNotWithinError">correlationNotWithinError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateDistribution">generateDistribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomGaussian">generateRandomGaussian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getPearsonCorrelation">getPearsonCorrelation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pointNotWithinRequiredStdDevs">pointNotWithinRequiredStdDevs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_coordinates">prepare_coordinates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-random_bm">random_bm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readjustPoints">readjustPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-transformPoints">transformPoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomDistribution">generateRandomDistribution</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomUniform">generateRandomUniform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateUniformDistribution">generateUniformDistribution</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing">experiment-properties/graphing</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_color">generate_color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_color_hex">generate_color_hex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_custom_plot">is_custom_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_custom_plot">prepare_custom_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add_graph_features">add_graph_features</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_attributes_object">generate_attributes_object</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_distributions">plot_distributions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-base-plots">experiment-properties/graphing/d3-base-plots</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_parallel_plot">create_parallel_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_ring_plot">create_ring_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_scatter_plot">create_scatter_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_scatter_points">plot_scatter_points</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_shape_plot">create_shape_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_strip_plot">create_strip_plot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-custom-plots">experiment-properties/graphing/d3-custom-plots</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_distractor_scatter_plot">create_distractor_scatter_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_bisection_plot">create_estimation_bisection_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_interference_plot">create_estimation_interference_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_multi_interference_plot">create_estimation_multi_interference_plot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-create_estimation_plot">create_estimation_plot</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-graphing-d3-plot-features">experiment-properties/graphing/d3-plot-features</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-combine_target_and_distractor">combine_target_and_distractor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-plot_mixed_attribute_graph">plot_mixed_attribute_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_array_mix_graph">prepare_array_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_mix_graph">prepare_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_targeted_mix_graph">prepare_targeted_mix_graph</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepare_visual_mask_graph">prepare_visual_mask_graph</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-properties-instructions">experiment-properties/instructions</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_subcond_instruction_block">generate_subcond_instruction_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_instructions">get_instructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_jspsych_instructions">get_jspsych_instructions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-instruction-screen">experiment-timeline/instruction_screen</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_instructions">generate_instructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_ready_screen">generate_ready_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_sitting_distance_screen">generate_sitting_distance_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_welcome">generate_welcome</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-resolution-scaling">experiment-timeline/resolution_scaling</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-manual_resolution_scaling">manual_resolution_scaling</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resolution_scaling">resolution_scaling</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiment-timeline-screening">experiment-timeline/screening</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningInstructions">screeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningPCPInverted">screeningPCPInverted</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-instructionsRegression">instructionsRegression</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningCorrelationSelect">screeningCorrelationSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningCorrelationSort">screeningCorrelationSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningInstructions">screeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningQuestions">screeningQuestions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningRegressionSelect">screeningRegressionSelect</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-colorScreeningInstructions">colorScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ignoreScreeningInstructions">ignoreScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-luminanceScreeningInstructions">luminanceScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-orientationScreeningInstructions">orientationScreeningInstructions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screeningStripColorYellowBlue">screeningStripColorYellowBlue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screenningStripLuminanceSort">screenningStripLuminanceSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-screenningStripOrientationSort">screenningStripOrientationSort</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-ensemble-average">experiments/ensemble_average</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/ensemble_average/ensemble_average.js~Ensemble_Average.html">Ensemble_Average</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ensemble_avg_exp">ensemble_avg_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-estimation">experiments/estimation</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/estimation/estimation.js~Estimation.html">Estimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-estimation_exp">estimation_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-hybrid">experiments/hybrid</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/hybrid/hybrid.js~Hybrid.html">Hybrid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hybrid_exp">hybrid_exp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_exp">jnd_exp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stevens_exp">stevens_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-jnd">experiments/jnd</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/jnd/jnd.js~JND.html">JND</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_block">generate_experiment_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_end">generate_experiment_end</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_screen">generate_feedback_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_block">generate_practice_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_ready_experiment">generate_ready_experiment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_stop_block">generate_stop_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_exp">jnd_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-jnd-radius">experiments/jnd_radius</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/jnd_radius/jnd_radius.js~JND_Radius.html">JND_Radius</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jnd_radius_exp">jnd_radius_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-numerosity">experiments/numerosity</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/numerosity/numerosity.js~Numerosity.html">Numerosity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-numerosity_exp">numerosity_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing">experiments/sequencing</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing/sequencing.js~Sequencing.html">Sequencing</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IMAGE_PATH">IMAGE_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_exp">sequencing_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing-side-by-side">experiments/sequencing_side_by_side</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing_side_by_side/sequencing_side_by_side.js~Sequencing_Side_by_Side.html">Sequencing_Side_by_Side</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IMAGE_PATH">IMAGE_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_side_by_side_exp">sequencing_side_by_side_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-sequencing-symbols">experiments/sequencing_symbols</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/sequencing_symbols/sequencing_symbols.js~Sequencing_Symbols.html">Sequencing_Symbols</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment">generate_experiment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_experiment_end">generate_experiment_end</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_screen">generate_feedback_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feedback_wrapper">generate_feedback_wrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_block">generate_practice_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_practice_instruction_block">generate_practice_instruction_block</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_stop_practice_trials">generate_stop_practice_trials</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECTANGLE_MASK_PATH">RECTANGLE_MASK_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SQUARE_MASK_PATH">SQUARE_MASK_PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sequencing_symbols_exp">sequencing_symbols_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-stevens">experiments/stevens</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/stevens/stevens.js~Stevens.html">Stevens</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stevens_exp">stevens_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#experiments-visual-search">experiments/visual_search</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/experiments/visual_search/visual_search_timeline.js~Visual_Search.html">Visual_Search</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_color_paths">get_color_paths</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hex_to_color">hex_to_color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-visual_search_exp">visual_search_exp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#helpers">helpers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/scripts/helpers/correlation_dependencies.js~Correlation_Dependencies.html">Correlation_Dependencies</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-above_and_below_generate_random_trial_array">above_and_below_generate_random_trial_array</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-bundle_z_values">bundle_z_values</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-check_params">check_params</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-force_greater_right_position">force_greater_right_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_feature_search_trials">generate_feature_search_trials</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate_timeline_screen">generate_timeline_screen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-genereate_hybrid_instruction">genereate_hybrid_instruction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getScreenHeight">getScreenHeight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_mixed_graph_styles">get_mixed_graph_styles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_mixed_masks">get_mixed_masks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_num_blocks">get_num_blocks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_running_average">get_running_average</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_single_graph_style">get_single_graph_style</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get_single_mask">get_single_mask</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-is_converged_in_window">is_converged_in_window</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nova_variables">nova_variables</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_graph_attributes_mixed">randomize_graph_attributes_mixed</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_position">randomize_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_position_symmetric">randomize_position_symmetric</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-randomize_radius_position">randomize_radius_position</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-repeat_y_values">repeat_y_values</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-shuffleArray">shuffleArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-correlation_dependencies">correlation_dependencies</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">scripts/experiments/jnd/jnd.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { balance_subconditions } from &apos;/scripts/experiment-properties/balancing/balancing_controller.js&apos;
import { plot_distributions } from &quot;/scripts/experiment-properties/graphing/graphing_controller.js&quot;;
import { print_curr_trial } from &quot;/scripts/experiment-properties/counter/counter_controller.js&quot;;
import { initialize_random_order } from &apos;/scripts/experiment-properties/balancing/generators/random_generator.js&apos;
import { get_data } from &apos;/scripts/experiment-properties/data/data_controller.js&apos;
import { randomize_position, check_params } from &apos;/scripts/helpers/experiment_helpers.js&apos;
import { correlation_dependencies } from &quot;../../helpers/correlation_dependencies.js&quot;;
import { generate_initial_distribution, generate_adjusted_distribution } from &apos;../../experiment-properties/distribution/distribution_controller.js&apos;;

export default class JND {

  /**
   * Initializes a JND experiment object.
   *
   * @param  {assoc array}  Parameters passed from routing.
   */
  constructor(params) {

    console.log(&quot;jnd.js log&quot;, params)

    let trial_structure = params[&quot;trial_structure&quot;];
    let condition_name = params[&quot;condition&quot;];
    let graph_type = params[&quot;graph_type&quot;];
    let balancing_type = params[&quot;balancing&quot;];
    let conversion_factor = params[&quot;conversion_factor&quot;];

    this.condition_name = condition_name;
    this.condition_group = this.condition_name.split(&apos;_&apos;)[0]; // Mostly to handle &quot;distractor&quot; conditions.
                                                              // TODO: Should have a better flag for it.
    this.subject_id = params[&quot;subject_id&quot;];
    this.subject_initials = params[&quot;subject_initials&quot;];
    this.auto_mode = false;

    this.is_practice_trials = params[&quot;is_practice_trials&quot;];
    this.is_screening = params[&quot;is_screening&quot;];
    this.manual_scaling_factor = params[&quot;manual_scaling_factor&quot;]
    this.custom_subcondition_order = params[&quot;custom_subcondition_order&quot;];

    
    this.is_complete = false; // whether completing at least ONE subcondition

    // ========================================
    // PARAMETER CHECKING

    // **NOTE: EXPERIMENTS variable comes from /public/config/experiments-config.js

    check_params(this, &quot;jnd&quot;, trial_structure, graph_type, balancing_type);

    // ========================================
    // EXPERIMENT CONSTANTS
    this.EXPERIMENT_NAME = &quot;JND&quot;;
    this.PIXELS_PER_CM = conversion_factor;
    this.MIN_CORRELATION = 0.0;
    this.MAX_CORRELATION = 1.0;
    this.MIN_TRIALS = 24;
    this.MAX_TRIALS = 52;
    this.WINDOW_SIZE = 24;
    this.WINDOW_INTERVAL = 3;
    this.CONVERGENCE_THRESHOLD = 0.75;
    this.INCORRECT_MULTIPLIER = 3;
    this.MAX_PRACTICE_TRIALS = 3;


    // FLAGS
    this.converged = false; // required for data saving logic
    this.practice_end = false; // required for counter logic 

    // ========================================
    // PRACTICE EXPERIMENT VARIABLES

    this.practice_conditions_constants;
    this.current_practice_condition_index;

    // ========================================
    // TEST EXPERIMENT VARIABLES

    this.sub_condition_order;
    this.sub_conditions_constants;
    this.current_sub_condition_index;
    this.adjusted_quantity_matrix = {};   // The matrix is in this format:
                                          // { sub_condition_index : [adjusted_quantity1, adjusted_quantity2 ... ] }
    this.adjusted_quantity_practice = [];


    // ========================================
    // DEBUG VARIABLES
    this.end_sub_condition_debug = false;

    // ========================================
    // CURRENT TRIAL DATA

    // Plotting-related vars
    this.left_coordinates = &quot;&quot;;
    this.right_coordinates = &quot;&quot;;
    this.distractor_coordinates = &quot;&quot;;

    // JsPsych trial_data for the current trial
    this.trial_data = &quot;&quot;;

    // ========================================
    // PREPARE EXPERIMENT

    // Extract raw constants
    this.raw_constants = get_data(this);

    // Prepare experiment + practice data
    this.prepare_experiment();
    this.prepare_practice();

    // ========================================
    // Adjusted Statistic Values
    // ** Previously were set inside the get_next_adjusted_statistic method.
    // ** Replacing constants into variables to be set inside the method.
    let correct_statistic_increment;
    let incorrect_statistic_increment;
  }

  /**
   * Orders the input data according to balancing type and
   * initializes the JND object&apos;s variables.
   *
   * @param  balancing_type {string}                             Type of balancing. Currently only latin_square
   *                                                             is supported.
   *         dataset {[{assoc array}, {assoc array}, ... ]}      The data to be ordered.
   */
  prepare_experiment() {

    let dataset = this.raw_constants;

    this.sub_condition_order = balance_subconditions(this.balancing_type, this.constructor.name.toLowerCase(), dataset.length, dataset, &quot;block&quot;, this.custom_subcondition_order);

    var ordered_dataset = [];

    // Order the data set according to the latin square
    // Initialize adjusted_quantity_matrix size
    for (let i=0; i &lt; this.sub_condition_order.length; i++){
      ordered_dataset[i] = dataset[this.sub_condition_order[i]];
      this.adjusted_quantity_matrix[i] = [];
    }

    this.sub_conditions_constants = ordered_dataset;
    this.current_sub_condition_index = 0;
  }

  /**
   * Orders the input dataset by randomizing it, and initializes the practice variables.
   *
   * @param  dataset {[{assoc array}, {assoc array}, ... ]}   The data to be ordered.
   */
  prepare_practice() {

    let dataset = this.raw_constants;

    this.sub_condition_order = initialize_random_order(dataset.length);
    let practice_dataset = [];
    this.practice_conditions_constants = this.sub_conditions_constants.slice(0,1);
    console.log(this.practice_conditions_constants)

    // Order the data set according to the latin square
    // Initialize adjusted_quantity_matrix size
    for (let i=0; i &lt; this.practice_conditions_constants.length; i++){
      console.log(&apos;subcondition order length &apos; + this.sub_condition_order.length)
      practice_dataset[i] = dataset[this.sub_condition_order[i]];
      this.adjusted_quantity_practice[i] = [];
    }

    //practice_dataset[this.sub_condition_order.length] = dataset[this.sub_condition_order[1]]
    //console.log(&apos;practice_dataset&apos;, practice_dataset)

    // Set practice trials
    this.current_practice_condition_index = 0;
  }

  /**
   * Generates a JND trial object for use in the JsPsych timeline.
   *
   * @param  type {string}             &quot;test&quot; or &quot;practice&quot;
   * @return trial {object}
   */
  generate_trial(block_type) {

    if ((block_type !== &quot;test&quot;) &amp;&amp; (block_type !== &quot;practice&quot;)) {throw Error(block_type + &quot; is not supported.&quot;)};
 
    // Initialize a variable for this so it is usable inside on_start
    var jnd_exp = this;

    var trial = {
      type:&apos;d3-plot-keyboard-response&apos;,
      block_type: block_type,
      choices:[&apos;z&apos;, &apos;m&apos;, &apos;q&apos;, &apos;t&apos;,&apos;w&apos;], //q is exit button (for debugging)
      order: &quot;jnd&quot;,
      response_ends_trial: true,
      post_trial_gap: 50,
      exp_obj: jnd_exp,
      plot_distributions: plot_distributions,
      print_curr_trial: print_curr_trial,
      data: {},
      on_start: function(trial){ // NOTE: on_start takes in trial var
        jnd_exp.cur_exp_type = block_type;
        
        if (jnd_exp.auto_mode) {
          trial.post_trial_gap = 12;
          trial.trial_duration = 12;
        }

        // Set the constants to be used:
        var index = correlation_dependencies.get_subcondition_index(jnd_exp, block_type);
        var constants = correlation_dependencies.get_constants(jnd_exp, block_type, index);

        // Calculate adjusted value
        var adjusted_value = correlation_dependencies.calculate_adjusted_value(jnd_exp, constants, block_type);

        // Handling saving this trial&apos;s data:
        jnd_exp.handle_data_saving(trial, block_type, constants, index, adjusted_value);

        // Generate distributions
        var base_coordinates = generate_initial_distribution(constants)
        var adjusted_coordinates = generate_adjusted_distribution(constants, adjusted_value);

        // trial block for symmetric jnd
        if (jnd_exp.condition_group === &quot;symmetric&quot;){
          var adjusted_value_high = constants.adjusted_correlation_high;
          var adjusted_value_low = constants.adjusted_correlation_low;

          jnd_exp.handle_data_saving(trial, block_type, constants, index, adjusted_value_high);
          jnd_exp.handle_data_saving(trial, block_type, constants, index, adjusted_value_low);

          var low_coordinates = generate_adjusted_distribution(constants, adjusted_value_low);
          var high_coordinates = generate_adjusted_distribution(constants, adjusted_value_high)

        }

        if (jnd_exp.condition_group === &quot;distractor&quot;){
          let dist_attributes = constants.dist_attributes;
          let dist_correlation = constants.dist_attributes.correlation;
          var left_dist_coordinates = generate_adjusted_distribution(dist_attributes, dist_correlation);
          var right_dist_coordinates = generate_adjusted_distribution(dist_attributes, dist_correlation);

          jnd_exp.distractor_coordinates = [left_dist_coordinates, right_dist_coordinates];
        }

        // Randomize position of the base and adjusted graphs
        var result = randomize_position(trial,
                                       base_coordinates,
                                       adjusted_coordinates,
                                       constants,
                                       adjusted_value);
        // // For testing purposes, can force R graph to have greater correlation
        // var result = force_greater_right_position(trial,
        //                                           base_coordinates,
        //                                           adjusted_coordinates,
        //                                           constants.base_correlation,
        //                                           adjusted_correlation);

        // Set up D3 variables for plotting
        jnd_exp.coordinates = [result.left, result.right];

        jnd_exp.trial_data = trial.data;

        if (constants.task) {
          console.log(&quot;[TASK TYPE]: &quot; + constants.task);
        }
        jnd_exp.trial_data = trial.data; 
        trial.exp_obj = jnd_exp;
        console.log(&quot;[RIGHT] Correlation: &quot; + trial.data.right_correlation);
        console.log(&quot;[RIGHT] Num points: &quot; + trial.data.right_num_points);

        console.log(&quot;[LEFT] Correlation: &quot; + trial.data.left_correlation);
        console.log(&quot;[LEFT] Num points: &quot; + trial.data.left_num_points);

      },
      on_finish: function(data){ // NOTE: on_finish takes in data var
        // Set the constants to be used:
        if (data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(&apos;t&apos;) || jnd_exp.auto_mode) {
          // Turn on automation
          jnd_exp.auto_mode = true;
          console.log(Math.random() &lt; 0.5 ? &quot;&apos;z&apos; pressed&quot; : &quot;&apos;m&apos; pressed&quot;);
          data.key_press = Math.random() &lt; 0.5 ? jsPsych.pluginAPI.convertKeyCharacterToKeyCode(&apos;z&apos;) : jsPsych.pluginAPI.convertKeyCharacterToKeyCode(&apos;m&apos;);
        }
        let index = correlation_dependencies.get_subcondition_index(jnd_exp, block_type);
        let constants = correlation_dependencies.get_constants(jnd_exp, block_type, index);

        data.correct = jnd_exp.check_response(data, constants);
        console.log(&quot;RESPONSE: &quot; + data.correct);
      }
    };


    return trial;
  }

  /**
 * Generates conditional timeline instruction for JND and Stevens hybrid conditions.
 * @returns {jsPsych trial}
 */
 genereate_hybrid_instruction(){
  let jnd_exp = this
  let instructions = `&lt;div align = &apos;center&apos;&gt;
                        &lt;p&gt; Please exit full screen mode and switch to the Stevens Task.
                          &lt;br&gt; Do not close this window. You will return to it when the Stevens Task is completed.
                          &lt;br&gt; Enter full screen mode again and press any key to continue when you return.
                        &lt;/p&gt;
                      &lt;/div&gt;`

  let instruction_trial = {
    type: &apos;html-keyboard-response&apos;,
    stimulus: instructions
  };
  // conditional timeline wrapper
  let block_size = 3;
  var hybrid_timeline = {
    timeline: [instruction_trial],
    conditional_function: function() {
      console.log(&quot;Testing hybrid?!!!!!!!!!!&quot;)
      console.log(jnd_exp.end_sub_condition() &amp;&amp; (jnd_exp.current_sub_condition_index + 1) % block_size == 0)
      // if it is the end of the Sub Condition and the end of a block (assumes block size is 3 for hybrid tasks)
      if (jnd_exp.end_sub_condition() &amp;&amp; (jnd_exp.current_sub_condition_index + 1) % block_size == 0) {
        console.log(&quot;Hybrid case!&quot;)
        return true;
      }
      return false; 
    }
  };

  return hybrid_timeline
}

  /**
   * Handles saving the relevant data on a given trial.
   *
   * For reference, these are the helper variables created to assist in trial logic (i.e not present in excel)
   * trial_variables =
   *       {type: &apos;jnd&apos;,
   *       run_type: &apos;&apos;,
   *       left_correlation: &apos;&apos;,
   *       right_correlation: &apos;&apos;,
   *       };
   *
   * These are variables created WITHIN the trial logic that were not present in excel (but need to be
   * outputted to results).
   * export_variables =
   *       {sub_condition: &apos;&apos;,           // Chronological ordering of sub_condition [1, 2, 3 ... ]
   *        balanced_sub_condition: &apos;&apos;,  // Index of sub_condition according to balancing order
   *        jnd: &apos;&apos;,
   *        base_correlation: &apos;&apos;,
   *        adjusted_value: &apos;&apos;,
   *        correct: &apos;&apos;,
   *       };
   *
   * @param trial {object}
   *        block_type {string}           &quot;test&quot; or &quot;practice&quot;
   *        constants {assoc array}
   *        index {integer}
   *        adjusted_value {double}
   */
  handle_data_saving(trial, block_type, constants, index, adjusted_value) {

    // Add all constants from excel
    trial.data = constants;

    // Adding constants that required computation (not from excel)
    trial.data.type = &quot;jnd&quot;;
    trial.data.adjusted_value = adjusted_value;

    if (constants.task) {

      switch (constants.task) {
        case &quot;numerosity&quot;:
          trial.data.adjusted_value_type = &quot;number of points&quot;;
          trial.data.jnd = Math.abs(adjusted_value - constants.num_points);
          break;
        case &quot;correlation&quot;:
          trial.data.adjusted_value_type = &quot;correlation&quot;;
          trial.data.jnd = Math.abs(adjusted_value - constants.base_correlation);
          break;
        default:
          throw Error(&quot;Calculations for jnd has not been handled for task: &quot; + constants.task);
      }

    } else {
      trial.data.jnd = Math.abs(adjusted_value - constants.base_correlation);
    }

    trial.data.sub_condition = index;
    trial.data.balanced_sub_condition = this.sub_condition_order[index];

    // Block specific saves
    let adjusted_quantity_matrix = correlation_dependencies.get_adjusted_quantity_matrix(this, block_type, index);
    adjusted_quantity_matrix[index].push(adjusted_value);
    trial.data.run_type = block_type;
  }


  /**
   * Given a JND trial data, determines whether response is
   * correct or not.
   *
   * @param  {JsPsych.data}  data
   * @param. {object}        constants
   * @return {boolean}
   */
  check_response(data, constants) {

    // For debugging purposes:
    if (data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(&apos;q&apos;)){
      //data.correct = -1;
      return -1;
    }
    
    // Skip current subcondition
    if (data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(&apos;w&apos;)){
      this.end_sub_condition_debug = true;
      //data.correct = -2; 
      return -2; // skip subcondition flag
    }
    

    let right_greater_clause;
    let left_greater_clause;

    if (!constants.task || constants.task === &quot;correlation&quot;) {

      right_greater_clause = data.right_correlation &gt; data.left_correlation;
      left_greater_clause = data.left_correlation &gt; data.right_correlation;

    } else if (constants.task === &quot;numerosity&quot;) {

      right_greater_clause = data.right_num_points &gt; data.left_num_points;
      left_greater_clause = data.left_num_points &gt; data.right_num_points;

    } else {
      throw Error(&quot;Check response function has not been handled for task: &quot; + constants.task);
    }

    if (right_greater_clause &amp;&amp; (data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(&apos;m&apos;)) ||
        left_greater_clause &amp;&amp; (data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(&apos;z&apos;))){

      //data.correct = true;
      return true;
    }
    // Assuming that if base_correlation = adjusted_correlation, at this point
    // any user choice is wrong.
    else {
      //data.correct = false;
      return false;
    }
  }

  /**
   * When called, will save individual trial data into a CSV.
   */
  export_trial_data() {

    var summary_data = [];

    let screening_json = jsPsych.data.get().filter({trial_type: &apos;survey-html-form&apos;}).select(&apos;responses&apos;).values[0]
    // Participant information
    // indexing might need to be genralized better if there are previous trials before the start of the experiment
    if(screening_json){
      console.log(&apos;Saving Screening&apos;)
      let screening_responses = JSON.parse(screening_json)
      let screening_data = {};
      screening_data.education = screening_responses[2].value
      screening_data.stat_classes_take = screening_responses[3].value
      screening_data.vision = screening_responses[4].value
      screening_data.gender = screening_responses[5].value
      screening_data.age = screening_responses[6].value
      summary_data.push(screening_data);
    }

    summary_data = summary_data.concat(this.get_summary_data())

    var trial_data = jsPsych.data.get().filter(this.condition_name==&apos;test_hybrid_scatter&apos;?{type: &apos;jnd&apos;}:{type: &apos;jnd&apos;, run_type: &apos;test&apos;})
                                       .filterCustom(function(x){ //Don&apos;t include the exit trials
                                         return x.correct != -1;
                                       })
                                       // JND&apos;s trial variables
                                       .ignore(&apos;type&apos;)
                                       .ignore(&apos;run_type&apos;)
                                       .ignore(&apos;left_correlation&apos;)
                                       .ignore(&apos;right_correlation&apos;)
                                       // These are variables forced on by jsPsych
                                       .ignore(&apos;stimulus&apos;)
                                       .ignore(&apos;key_press&apos;)
                                       .ignore(&apos;choices&apos;)
                                       .ignore(&apos;trial_type&apos;)
                                       .ignore(&apos;trial_index&apos;)
                                       .ignore(&apos;time_elapsed&apos;)
                                       .ignore(&apos;internal_node_id&apos;);
    // // TODO: js converting key_string to use double quotes, needs to be single to pass into ignore() fxn
    // //
    // // for (var key in jnd_exp.trial_variables){
    // //  var key_string = &apos;${key}&apos;;
    // //  trial_data.ignore(key);
    // // }

    if(this.is_local_save === &quot;true&quot;){
      trial_data.localSave(&apos;csv&apos;, string);    
    }
    else{
      trial_data = JSON.parse(trial_data.json());
      var data = summary_data.concat(trial_data);
      data = JSON.stringify(data);
      // var string = &quot;S&quot; + this.subject_id + &quot;_&quot; + this.condition_name + &quot;_jnd_trial_results.csv&quot;;
  
      // // TEMPORARY: test file save locally 
      // trial_data.localSave(&apos;csv&apos;, string);
  
      // Firebase upload
      $.post(&quot;/api/experiment_data&quot;,
              {trial_data: trial_data, 
                summary_data: summary_data, 
                experiment: &quot;JND&quot;, 
                condition: params[&quot;condition&quot;], 
                prolific_pid: params[&quot;subject_id&quot;], 
                study_id: params[&quot;study_id&quot;], 
                session_id: params[&quot;session_id&quot;]},
              function(data, status) {
                console.log(&quot;Data: &quot; + data + &quot;\nStatus: &quot; + status)
              }
            ); 
    }

  }

  /* SUMMARY DATA */

  get_summary_data(){
    let summary_data = []
    const condition_num = this.sub_conditions_constants.length;
    for (let i = 0; i&lt;condition_num ; i++){
      let summary_data_sub = this.get_summary_data_sub(i)
      summary_data.push(summary_data_sub);
    }
    return summary_data;
  }

  get_summary_data_sub(i){
    console.log(&quot;Getting summary index &quot;, i)
    var condition_data = jsPsych.data.get().filter({type: &apos;jnd&apos;, run_type: &apos;test&apos;, balanced_sub_condition: this.sub_condition_order[i]})
                                            .filterCustom(function(x){ //Don&apos;t include the exit trials
                                              return x.correct != -1;
                                            })
    var constants = this.sub_conditions_constants[i];   
    var summary_data_sub = {&quot;base&quot;:constants.base_correlation,
                            &quot;above&quot;:constants.converge_from_above, 
                            &quot;block&quot;:constants.block ,
                            &quot;num_points&quot;:constants.num_points,
                            &quot;jnd&quot;:condition_data.select(&apos;jnd&apos;).mean(),
                            &quot;trials&quot;:condition_data.count(),
                            &quot;rt&quot;:condition_data.select(&apos;rt&apos;).mean(),
                            &quot;converged&quot;: condition_data.last().select(&apos;converged&apos;).values[0]
                          };
    return summary_data_sub;
  }

  /**
   * When called, will save aggregated trial data into a CSV.
   */
  export_summary_data() {
    if (!confirm(&quot;Would you like to save the test summary?&quot;)){
        return;
    }

    var csv = &apos;SUBJECT_ID,SUBJECT_INITIALS,PLOT,BASE,ABOVE,NUM_POINTS,JND,TRIALS\n&apos;;

    var data = [];

    // Organize each row of the csv
    for (let i = 0; i&lt;this.sub_conditions_constants.length; i++){
      var row = [this.subject_id, this.subject_initials, this.condition_name];
      var constants = this.sub_conditions_constants[i];
      var condition_data = jsPsych.data.get().filter({type: &apos;jnd&apos;, run_type: &apos;test&apos;, balanced_sub_condition: this.sub_condition_order[i]})
                                             .filterCustom(function(x){ //Don&apos;t include the exit trials
                                                return x.correct != -1;
                                             })
      

      row.push(constants.base_correlation);
      row.push(constants.converge_from_above);
      row.push(constants.num_points);
      row.push(condition_data.select(&apos;jnd&apos;).mean());
      row.push(condition_data.count());
      row.push(condition_data.select(&apos;rt&apos;).mean())
      row.push(condition_data.last().select(&apos;converged&apos;).values[0])
      console.log(row)

      data.push(row);
    }

    // Append each row
    data.forEach(function(row){
      csv += row.join(&apos;,&apos;);
      csv += &quot;\n&quot;;
    });

    var hiddenElement = document.createElement(&apos;a&apos;);
    hiddenElement.href = &apos;data:text/csv;charset=utf-8,&apos; + encodeURI(csv);
    hiddenElement.target = &apos;_blank&apos;;
    hiddenElement.download = &quot;S&quot; + this.subject_id + &quot;_&quot; + this.condition_name + &quot;_jnd_summary_results.csv&quot;;
    hiddenElement.click();
  }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
